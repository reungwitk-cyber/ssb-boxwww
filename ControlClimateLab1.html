<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>LAB BOX ‚Äì Control Climate</title>

    <!-- =======================
       üîΩ SWITCH DROPDOWN LAB BOX 
       Bootstrap CSS
       ======================= -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- ======================= -->

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">

    <style>
        /* =========================================================
 ‚öôÔ∏è VARIABLES & RESETS
 - ‡∏£‡∏ß‡∏°‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏° layout ‡∏Ç‡∏≠‡∏á Zone B ‡∏î‡πâ‡∏ß‡∏¢
========================================================= */
        :root {
            --bg: #f0f2f5;
            --panel: #fff;
            --ink: #121619;
            --muted: #6b7280;
            --brand: #b7f36a;
            --accent: #9ad83f;
            --sidebar: #fff;
            --sidebar-border: #cde88b;
            --tab-height: 40px;
            --sidebar-width: 220px;
            --ring-bg: #e5e7eb;

            /* üîß ‡∏Ñ‡∏∏‡∏°‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡πÉ‡∏ô‡πÅ‡∏ñ‡∏ß‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå (Zone B) */
            --ctrl-icon: 42px;
            /* ‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡∏ã‡πâ‡∏≤‡∏¢‡∏Ç‡∏ô‡∏≤‡∏î‡∏Ñ‡∏á‡∏ó‡∏µ‡πà */
            --ctrl-pill: 128px;
            /* ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á pill */
            --ctrl-switch: 136px;
            /* ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏™‡∏ß‡∏¥‡∏ï‡∏ä‡πå+‡∏õ‡πâ‡∏≤‡∏¢ */
            --ctrl-row-h: 44px;
            /* ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥‡∏Ç‡∏≠‡∏á‡πÅ‡∏ñ‡∏ß */
        }

        * {
            box-sizing: border-box
        }

        html,
        body {
            height: 100%
        }

        body {
            margin: 0;
            font-family: 'Poppins', system-ui, -apple-system, Segoe UI, Roboto, Arial, Helvetica, sans-serif;
            color: var(--ink);
            background: var(--bg);
        }

        /* =========================================================
 üß± APP LAYOUT
========================================================= */
        .app {
            display: grid;
            grid-template-columns: var(--sidebar-width) 1fr;
            grid-template-rows: auto 1fr;
            height: 100vh;
        }

        /* =========================================================
 ‚¨ÜÔ∏è TOPBAR
========================================================= */
        .topbar {
            grid-column: 1/-1;
            background: var(--panel);
            border-bottom: 1px solid #e5e7eb;
            position: relative
        }

        .topbar-inner {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 10px 16px
        }

        .brand-logo {
            height: 34px
        }

        .title {
            background: var(--panel);
            border: 1px solid var(--sidebar-border);
            padding: 0 12px;
            border-radius: 6px;
            font-weight: 700;
            margin-right: 10px;
            font-size: 22px;
            color: #0f172a;
            letter-spacing: .5px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, .08)
        }

        .tabs {
            flex: 1;
            display: flex;
            align-items: flex-end;
            height: var(--tab-height);
            background: var(--brand);
            border-left: 1px solid var(--sidebar-border);
            border-right: 1px solid var(--sidebar-border);
            border-top-left-radius: 6px;
            border-top-right-radius: 6px;
            overflow-x: auto;
            scrollbar-width: none
        }

        .tabs::-webkit-scrollbar {
            display: none
        }

        .tab {
            position: relative;
            height: var(--tab-height);
            line-height: var(--tab-height);
            padding: 0 18px;
            font-size: 13px;
            color: #1f2937;
            cursor: pointer;
            user-select: none
        }

        .tab.active {
            font-weight: 600;
            border-bottom: 3px solid #3a3a3a
        }

        .tab:hover {
            background: rgba(0, 0, 0, .04)
        }

        .clock {
            position: absolute;
            right: 14px;
            top: 8px;
            text-align: right;
            font-size: 13px
        }

        .clock .date,
        .clock .time {
            font-weight: 700
        }

        .topbar-right {
            margin-left: auto;
            display: flex;
            align-items: center;
            gap: 12px
        }

        .topbar-right .clock {
            position: static
        }

        .darklight {
            margin-left: auto;
            padding: 6px 12px;
            border-radius: 20px;
            background: #f1f5f9;
            color: #0f172a;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            user-select: none;
            transition: .2s;
            border: 1px solid #e2e8f0
        }

        .darklight:hover {
            background: #e2e8f0
                /*hover ‡∏´‡∏°‡∏≤‡∏¢‡∏ñ‡∏∂‡∏á ‚Äú‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏≠‡∏≤‡πÄ‡∏°‡∏≤‡∏™‡πå‡πÑ‡∏õ‡∏ß‡∏≤‡∏á‡∏≠‡∏¢‡∏π‡πà‡πÄ‡∏´‡∏ô‡∏∑‡∏≠ element ‡∏ô‡∏±‡πâ‡∏ô*/
        }

        /* =========================================================
 üìö SIDEBAR
========================================================= */
        .sidebar {
            grid-row: 2/-1;
            background: var(--sidebar);
            border-right: 2px solid var(--sidebar-border);
            display: flex;
            flex-direction: column;
            min-width: 0
        }

        .menu {
            padding: 8px 8px 18px;
            display: flex;
            flex-direction: column;
            gap: 8px
        }

        .menu-btn {
            display: grid;
            grid-template-columns: 44px 1fr;
            align-items: center;
            gap: 10px;
            padding: 10px 8px;
            border-radius: 8px;
            border: 1px solid transparent;
            cursor: pointer;
            text-align: left;
            background: #fff;
            transition: .2s ease;
            color: #111
        }

        .menu-btn:hover {
            border-color: var(--accent);
            background: #fafff1
        }

        .menu-btn.active {
            background: #eaffc8;
            border-color: var(--accent);
            font-weight: 600
        }

        .ico img {
            width: 40px;
            height: 40px;
            display: block
        }

        .side-section {
            padding: 10px 14px;
            font-size: 13px;
            color: #111
        }

        /* =========================================================
 üì¶ CONTENT
========================================================= */
        .content {
            grid-column: 2/-1;
            grid-row: 2/-1;
            background: var(--panel);
            margin: 12px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, .05);
            border: 1px solid #e5e7eb;
        }

        .content-inner {
            display: grid;
            grid-template-columns: repeat(12, 1fr);
            grid-auto-rows: min-content;
            gap: 12px;
            padding: 0;
            border-left: 1px solid var(--accent)
        }

        .content-inner>.tabs {
            grid-column: 1/-1
        }

        /* =========================================================
 üå° CONTROL CLIMATE (Row A & B)
========================================================= */
        .control-climate {
            padding: 10px 40px 10px
        }

        /* Row A: ‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏ã‡πâ‡∏≤‡∏¢ + ‡πÄ‡∏Å‡∏à‡∏Ç‡∏ß‡∏≤ */
        .control-climate .rowA {
            display: grid;
            grid-template-columns: 250px minmax(0, 1fr);
            gap: 16px;
            align-items: start;
            width: 100%
        }

        /* Row B: ‡∏Å‡∏≤‡∏£‡πå‡∏î 3 ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå */
        .control-climate .rowB {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 16px
        }

        /* block ‡∏ô‡∏µ‡πâ‡∏Å‡∏¥‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á */
        .content-inner>.control-climate {
            grid-column: 1/-1
        }

        /* ‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô recipe */
        .icon1 img {
            width: 65px;
            height: 65px;
            object-fit: contain;
            display: block;
            margin: 6px;
            border-radius: 6px
        }

        /* =========================================================
 üÉè CARD + HEADERS
========================================================= */
        .cc-card {
            background: #fff;
            border: 1px solid var(--ring-bg);
            border-radius: 10px;
            padding: 5px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, .05);
            font-size: 13px
        }

        .cc-card .h {
            background: #cfe2ff;
            border-radius: 3px;
            display: flex;
            align-items: center;
            min-height: 36px;
            padding: 6px 8px
        }

        .cc-card .head {
            display: grid;
            grid-template-columns: 40px 1fr;
            gap: 40px;
            align-items: center
        }

        .cc-card .row1 {
            display: flex;
            justify-content: space-between;
            align-items: center;
            white-space: nowrap;
            margin: 6px 0;
            background: #f0f7f9;
            border-radius: 6px;
            padding: 5px
        }

        .divider {
            border-top: 1px dashed var(--ring-bg);
            margin: 2px 0 2px
        }

        /* =============
        ============================================
 ü•ß GAUGES
========================================================= */
        .gauges {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 12px;
            padding: 12px
        }

        .gauge {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px
        }

        .gauge .ring {
            --size: 132px;
            --track: #e5e7eb;
            --progress: #6ee7b7;
            width: var(--size);
            height: var(--size);
            border-radius: 50%;
            position: relative;
            display: grid;
            place-items: center;
            background: radial-gradient(#fff calc(50% - 10px), transparent calc(50% - 9px)), conic-gradient(var(--progress) calc(var(--p)*1%), var(--track) 0);
            box-shadow: 0 6px 16px rgba(0, 0, 0, .08), inset 0 0 0 1px #f1f5f9
        }

        .gauge .ring img {
            width: 60px;
            height: 60px;
            object-fit: contain;
            border-radius: 15px;
            background: #fff
        }

        .gauge .value {
            position: absolute;
            bottom: 12px;
            left: 0;
            right: 0;
            text-align: center;
            font-weight: 700;
            font-size: 18px
        }

        .gauge .unit {
            font-size: 12px;
            opacity: .8;
            margin-left: 2px
        }

        .gauge .label {
            font-size: 12px;
            font-weight: 600;
            color: #0f172a;
            background: #eeffcf;
            border: 1px solid #cce68f;
            padding: 4px 12px;
            border-radius: 999px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, .06)
        }

        #gAir .ring {
            --progress: #f87171
        }

        /* Temp */
        #gRH .ring {
            --progress: #34d399
        }

        /* RH   */
        #gCO2 .ring {
            --progress: #fb923c
        }

        /* CO2  */

        /* =========================================================
 üß© ZONE B ‚Äì ‡πÅ‡∏ñ‡∏ß‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå (‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô / ‡∏ä‡∏∑‡πà‡∏≠ / pill / ‡∏™‡∏ß‡∏¥‡∏ï‡∏ä‡πå)
 - ‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå ‚Äú‡∏Ç‡∏∂‡πâ‡∏ô‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡πÉ‡∏´‡∏°‡πà‡πÑ‡∏î‡πâ‚Äù ‡πÅ‡∏•‡∏∞‡∏™‡∏ß‡∏¥‡∏ï‡∏ä‡πå‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏Ç‡∏ß‡∏≤‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ô
========================================================= */
        .rowB {
            display: grid;
            grid-template-columns: repeat(3, minmax(0, 1fr));
            gap: 16px;
            align-items: start
        }

        .rowB .cc-card {
            padding-right: 10px
        }

        .rowB>.cc-card {
            min-width: 0
        }

        /* ‡πÉ‡∏´‡πâ‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏´‡∏î‡πÑ‡∏î‡πâ ‡πÑ‡∏°‡πà‡∏î‡∏±‡∏ô‡∏•‡πâ‡∏ô */

        /* ‡πÅ‡∏ñ‡∏ß‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå 4 ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏Ñ‡∏á‡∏£‡∏π‡∏õ */
        .ctrl-row {
            display: grid;
            grid-template-columns: var(--ctrl-icon) 1fr var(--ctrl-pill) var(--ctrl-switch);
            gap: 14px;
            align-items: center;
            margin: 6px;
            min-height: var(--ctrl-row-h)
        }

        /* ‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå: ‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡∏Ç‡∏∂‡πâ‡∏ô‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡πÉ‡∏´‡∏°‡πà */
        .ctrl-row>span {
            white-space: normal;
            overflow: visible;
            text-overflow: clip;
            line-height: 1.2;
            min-width: 0;
            word-break: break-word;
            overflow-wrap: anywhere;
            display: block
        }

        /* ‡πÄ‡∏Ñ‡∏™‡∏û‡∏¥‡πÄ‡∏®‡∏©: ‡πÉ‡∏ä‡πâ .ctrl-title ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô ‡πÅ‡∏•‡∏∞‡∏≠‡∏¢‡∏≤‡∏Å‡πÉ‡∏´‡πâ‡∏™‡πà‡∏ß‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏Ç‡∏∂‡πâ‡∏ô‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡πÉ‡∏´‡∏°‡πà‡∏à‡∏£‡∏¥‡∏á ‡πÜ */
        .ctrl-title span {
            display: block;
            margin-top: 2px
        }

        /* ‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡∏ã‡πâ‡∏≤‡∏¢ */
        .icon-sm {
            width: var(--ctrl-icon);
            height: var(--ctrl-icon);
            object-fit: contain;
            padding: 4px;
            display: block
        }

        /* pill ‡πÉ‡∏ô‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á */
        .ctrl-row .pill {
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            height: 36px;
            border-radius: 999px;
            padding: 6px 10px;
            margin-left: 0 !important;
            margin-right: 0 !important
        }

        /* ‡∏™‡∏ß‡∏¥‡∏ï‡∏ä‡πå‡∏Ç‡∏ß‡∏≤‡∏™‡∏∏‡∏î */
        .ctrl-row .switch-inline {
            display: flex;
            align-items: center;
            justify-content: flex-end;
            gap: 10px;
            width: 100%;
            white-space: nowrap
        }

        .ctrl-row .switch-inline .form-switch {
            padding-left: 0
        }

        .ctrl-row .switch-inline .form-check-input {
            margin-left: 0
        }

        .ctrl-row .switch-inline label {
            margin: 0
        }

        /* ‡∏Ç‡∏ô‡∏≤‡∏î‡∏™‡∏ß‡∏¥‡∏ï‡∏ä‡πå‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå‡∏Å‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡πÅ‡∏ñ‡∏ß */
        .switch-lg.form-check-input {
            width: 3.4rem;
            height: 1.4rem
        }

        /* =========================================================
 üí° LIGHT / LAMP / SETPOINT ROWS
========================================================= */
        .light-row {
            display: flex;
            gap: 10px;
            align-items: center;
            margin: 6px
        }

        .lamp-row {
            display: grid;
            grid-template-columns: 60px 60px auto auto auto 60px;
            gap: 8px;
            align-items: center;
            margin: 4px 0
        }

        .sp-row {
            display: grid;
            grid-template-columns: 28px 1fr auto auto;
            gap: 8px;
            align-items: center;
            margin-bottom: 6px
        }

        .icon-smd {
            width: 80px;
            height: 45px;
            object-fit: contain;
            padding: 2px
        }

        .muted {
            color: var(--muted)
        }

        /* =========================================================
 üì± RESPONSIVE
========================================================= */
        /* ‚úÖ ‡∏à‡∏≠ 15.6" (~1366px) ‚Üí RowB ‡πÄ‡∏´‡∏•‡∏∑‡∏≠ 2 ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå ‡∏•‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏ö‡∏µ‡∏¢‡∏î */
        @media (max-width:1800px) {
            .control-climate .rowB {
                grid-template-columns: 1fr 1fr
            }
        }

        @media (max-width:1100px) {
            .control-climate .rowA {
                grid-template-columns: 1fr
            }

            .control-climate .rowB {
                grid-template-columns: 1fr
            }

            /* ‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏á 1 ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå */
            .gauges {
                grid-template-columns: repeat(2, 1fr)
            }
        }

        /* ‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠: 2 ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î/‡πÅ‡∏ñ‡∏ß
   ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ö‡∏ô: ‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô | ‡∏ä‡∏∑‡πà‡∏≠ | ‡∏™‡∏ß‡∏¥‡∏ï‡∏ä‡πå
   ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏•‡πà‡∏≤‡∏á: (‡∏ß‡πà‡∏≤‡∏á) | pill | pill */
        @media (max-width:560px) {
            :root {
                --ctrl-icon: 36px;
                --ctrl-switch: 120px
            }

            .ctrl-row {
                grid-template-columns: 36px 1fr var(--ctrl-switch);
                grid-template-areas:
                    "icon title switch"
                    ".    pill  pill";
                gap: 10px;
            }

            .ctrl-row img.icon-sm {
                grid-area: icon
            }

            .ctrl-row>span {
                grid-area: title
            }

            .ctrl-row .pill {
                grid-area: pill
            }

            .ctrl-row .switch-inline {
                grid-area: switch
            }
        }

        /* =========================================================
 ‚¨áÔ∏è DROPDOWNS
========================================================= */
        .sidebar .dropdown .btn {
            background: #ffffff;
            border-radius: 12px;
            font-weight: 600;
            box-shadow: 0 4px 10px rgba(0, 0, 0, .15);
            transition: all .3s ease;
            width: 100%;
            text-align: left
        }

        .sidebar .dropdown .btn:hover {
            background: #f1f1f1;
            transform: translateY(-2px)
        }

        .sidebar .dropdown-menu {
            border-radius: 12px;
            border: none;
            box-shadow: 0 6px 20px rgba(0, 0, 0, .15);
            animation: fadeIn .3s ease;
            width: 100%;
            z-index: 1000
        }

        .sidebar .dropdown-item {
            font-weight: 500;
            padding: 10px 20px;
            transition: all .2s ease
        }

        .sidebar .dropdown-item:hover {
            background-color: #fda085;
            color: #fff;
            border-radius: 8px
        }

        /* (‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏ä‡∏∏‡∏î‡∏™‡∏≠‡∏á ‚Äì vitsidebar) */
        .vitsidebar .dropdown .btn {
            background: #bcf1c3;
            border-radius: 12px;
            font-weight: bold;
            box-shadow: 0 4px 10px rgba(0, 0, 0, .15);
            transition: all .3s ease;
            width: 100%;
            text-align: left
        }

        .vitsidebar .dropdown .btn:hover {
            background: #f1f1f1;
            transform: translateY(-2px)
        }

        .vitsidebar .dropdown-menu {
            border-radius: 12px;
            border: none;
            box-shadow: 0 6px 20px rgba(0, 0, 0, .15);
            animation: fadeIn .3s ease;
            width: 100%;
            z-index: 1000
        }

        .vitsidebar .dropdown-item {
            font-weight: 500;
            padding: 10px 20px;
            transition: all .2s ease
        }

        .vitsidebar .dropdown-item:hover {
            background-color: #fda085;
            color: #fff;
            border-radius: 8px
        }

        /* =========================================================
 üß≤ SWITCH & PILL STATES
========================================================= */
        .switch-inline {
            white-space: nowrap
        }

        /* ‡∏õ‡πâ‡∏≤‡∏¢ On/Off ‡πÑ‡∏°‡πà‡∏û‡∏±‡∏ö */
        .form-switch .form-check-input:checked {
            background-color: #9cf791;
            border-color: #7cff09
        }

        .pill.auto {
            background: #dcf8bc;
            color: #000
        }

        .pill.manual {
            background: #e54b4b;
            color: #fff
        }

        .pill.task {
            background: #f7c708;
            color: #000
        }

        .pill.off {
            background: #f3f3f3;
            color: #000
        }

        .pill {
            min-width: var(--ctrl-pill);
            justify-content: center
        }

        .switch-inline.is-pending {
            opacity: .5;
            pointer-events: none
        }

        .form-check-input.is-pending {
            opacity: .6;
            cursor: wait
        }

        .pill.is-pending {
            opacity: .7;
            pointer-events: none
        }

        /* ‡∏õ‡∏∏‡πà‡∏° MODE (‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô) + ‡∏™‡∏µ‡∏ï‡∏≤‡∏°‡πÇ‡∏´‡∏°‡∏î */
        #modeDropdown .btn {
            font-weight: 700;
            border-radius: 12px;
            border: 1px solid transparent;
            transition: background-color .2s ease, color .2s ease, filter .15s ease, opacity .15s ease
        }

        #modeDropdown .btn.mode-auto {
            background: #dcf8bc;
            color: #0f172a;
            border-color: #cce68f
        }

        #modeDropdown .btn.mode-manual {
            background: #e54b4b;
            color: #fff;
            border-color: #c73b3b
        }

        #modeDropdown .btn.mode-task {
            background: #f7c708;
            color: #000;
            border-color: #deb600
        }

        #modeDropdown .btn.mode-off {
            background: #f3f3f3;
            color: #000;
            border-color: #e5e7eb
        }

        #modeDropdown .btn.is-pending {
            opacity: .6;
            pointer-events: none;
            filter: grayscale(30%)
        }

        /* =========================================================
 üß© Utilities ‚Äî ‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î + ‚Ä¶ (webkit + ‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô‡πÅ‡∏ö‡∏ö @supports)
 ‡πÉ‡∏ä‡πâ‡∏Å‡∏±‡∏ö <span class="clamp-1|clamp-2|clamp-3"> ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô .ctrl-row
========================================================= */

        /* ===== Multi-line clamp ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå ===== */
        .ctrl-row>span[class*="clamp-"] {
            display: -webkit-box;
            /* ‡πÉ‡∏´‡πâ -webkit-line-clamp ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô */
            -webkit-box-orient: vertical;
            overflow: hidden;
            /* ‡∏ï‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏Å‡∏¥‡∏ô */
            /* (optional) text-overflow: ellipsis;  // ‡∏ö‡∏£‡∏≤‡∏ß‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏™‡πà‡∏ß‡∏ô‡πÉ‡∏´‡∏ç‡πà‡πÑ‡∏°‡πà‡πÅ‡∏™‡∏î‡∏á ‚Ä¶ ‡πÅ‡∏ö‡∏ö‡∏´‡∏•‡∏≤‡∏¢‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î ‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡∏û‡∏±‡∏á */
        }

        /* ‡πÉ‡∏™‡πà‡∏ó‡∏±‡πâ‡∏á‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô + webkit ‡πÉ‡∏ô‡∏Å‡∏é‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ï‡∏±‡∏î warning */
        .ctrl-row>span.clamp-1 {
            -webkit-line-clamp: 1;
            line-clamp: 1;
        }

        .ctrl-row>span.clamp-2 {
            -webkit-line-clamp: 2;
            line-clamp: 2;
        }

        .ctrl-row>span.clamp-3 {
            -webkit-line-clamp: 3;
            line-clamp: 3;
        }



        /* === Global fix: align all right-edge switches to the same vertical line === */
        .ctrl-row .switch-inline {
            display: grid;
            grid-template-columns: 1fr auto;
            /* ‡πÉ‡∏´‡πâ label ‡∏Å‡∏¥‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ã‡πâ‡∏≤‡∏¢, switch ‡∏ä‡∏¥‡∏î‡∏Ç‡∏ß‡∏≤‡πÅ‡∏ô‡πà‡∏ô‡∏≠‡∏ô */
            align-items: center;
            justify-content: space-between;
            gap: 6px;
        }

        .ctrl-row .switch-inline .form-check-input {
            justify-self: end;
            /* ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÉ‡∏´‡πâ‡∏õ‡∏∏‡πà‡∏° toggle ‡∏≠‡∏¢‡∏π‡πà‡∏Ç‡∏≠‡∏ö‡∏Ç‡∏ß‡∏≤‡πÄ‡∏™‡∏°‡∏≠ */
        }

        .ctrl-row .switch-inline label {
            justify-self: start;
            /* label ‡∏≠‡∏¢‡∏π‡πà‡∏î‡πâ‡∏≤‡∏ô‡∏ã‡πâ‡∏≤‡∏¢‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏°‡∏±‡∏ô‡πÄ‡∏≠‡∏á */
            margin: 0;
            text-align: right;
            font-size: 13px;
        }

        /* === FORCE ALIGN: Make all switches share the same right edge === */
        :root {
            --switch-label-width: 80px;
            /* ‡∏õ‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á label ‡πÉ‡∏´‡πâ‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ô‡∏ó‡∏∏‡∏Å‡∏ï‡∏±‡∏ß */
        }

        .ctrl-row .switch-inline {
            display: flex;
            justify-content: flex-end;
            align-items: center;
            gap: 8px;
            width: 100%;
        }

        .ctrl-row .switch-inline label {
            width: var(--switch-label-width);
            text-align: right;
            margin: 0;
            font-size: 13px;
            white-space: nowrap;
        }

        .ctrl-row .switch-inline .form-check-input {
            margin: 0;
            flex-shrink: 0;
        }

        /* ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Agitator (stack: In/Out 2 ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡πÅ‡∏ô‡∏ß‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô) */
        .ctrl-row .switch-inline.stack {
            flex-direction: column;
            align-items: flex-end;
            justify-content: center;
            gap: 6px;
        }

        .ctrl-row .switch-inline.stack label {
            width: var(--switch-label-width);
            text-align: right;
        }
    </style>




</head>

<body>
    <div class="app">
        <!-- Topbar -->
        <header class="topbar">
            <div class="topbar-inner">
                <div class="brand-badge">
                    <img src="https://github.com/reungwitk-cyber/ssb-box/raw/c958231f7e20c74bff3076384c1e46bbee9eec24/Logosbb-box.png"
                        alt="SABIENG BOX Logo" class="brand-logo">
                </div>
                <div class="title">LAB BOX</div>
                <div class="topbar-right">

                    <div class="dropdown" id="modeDropdown">
                        <button class="btn dropdown-toggle px-5 py-0" type="button" data-bs-toggle="dropdown">
                            MODE
                        </button>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="#" data-val="1">AUTO</a></li>
                            <li><a class="dropdown-item" href="#" data-val="0">MANUAL</a></li>
                            <li><a class="dropdown-item" href="#" data-val="2">TASK</a></li>
                        </ul>
                    </div>



                    <button class="darklight">darklight</button>
                    <div class="clock">
                        <div class="date" id="dateText"></div>
                        <div class="time" id="timeText"></div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="menu" style="padding-top:10px">
                <button class="menu-btn active"><span class="ico"><img
                            src="https://github.com/reungwitk-cyber/ssb-box/raw/c958231f7e20c74bff3076384c1e46bbee9eec24/homesw1.png"
                            alt="Home"></span><span>Sabieng HQ</span></button>
            </div>
            <div class="side-section">
                <div class="dropdown">
                    <button class="btn dropdown-toggle px-4 py-2" type="button" data-bs-toggle="dropdown"
                        aria-expanded="false">‚öôÔ∏è LAB BOX</button>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="Labbox.html">LABBOX</a></li>
                        <li><a class="dropdown-item" href="single.html">SINGLE</a></li>
                        <li><a class="dropdown-item" href="double.html">DOUBLE</a></li>
                    </ul>
                </div>
            </div>
            <div class="menu">
                <button class="menu-btn"><span class="ico"><img
                            src="https://github.com/reungwitk-cyber/ssb-box/raw/695cd88b6d596bfbd2b4bb6e83b47e81ab779a1f/RecipeSw.png"
                            alt="Recipes"></span><span>Recipes</span></button>
                <button class="menu-btn"><span class="ico"><img
                            src="https://github.com/reungwitk-cyber/ssb-box/raw/cf3649fc297bab4602cac39e05810940d42b774f/Crop%20yield.png"
                            alt="Crop scheduling"></span><span>Crop scheduling</span></button>
                <button class="menu-btn"><span class="ico"><img
                            src="https://github.com/reungwitk-cyber/ssb-box/raw/cf3649fc297bab4602cac39e05810940d42b774f/Crop%20scheduling.png"
                            alt="Crop yield"></span><span>Crop yield</span></button>
                <button class="menu-btn"><span class="ico"><img
                            src="https://github.com/reungwitk-cyber/ssb-box/raw/cf3649fc297bab4602cac39e05810940d42b774f/Energy%20Management.png"
                            alt="Energy"></span><span>Energy Management</span></button>
                <button class="menu-btn"><span class="ico"><img
                            src="https://github.com/reungwitk-cyber/ssb-box/raw/cf3649fc297bab4602cac39e05810940d42b774f/SettingSw1.png"
                            alt="Settings"></span><span>Setting</span></button>
                <button class="menu-btn"><span class="ico"><img
                            src="https://github.com/reungwitk-cyber/ssb-box/raw/cf3649fc297bab4602cac39e05810940d42b774f/Help.png"
                            alt="Help"></span><span>Help</span></button>
            </div>
        </aside>

        <!-- Content -->
        <main class="content">
            <div class="content-inner">
                <nav class="tabs">
                    <div class="tab" data-href="DashboardLab1.html">Dashboard</div>
                    <div class="tab active">Control Climate</div>
                    <div class="tab" data-href="ControlNutrientsLab1.html">Control Nutrients</div>
                    <div class="tab">Recipe</div>
                    <div class="tab">Notification</div>
                    <div class="tab">Analysis</div>
                </nav>

                <section class="control-climate">
                    <div class="rowA">
                        <!-- left card -->
                        <div class="cc-card">
                            <div class="h">Farm Climate</div>
                            <div class="head">
                                <div class="icon1">
                                    <img src="https://github.com/reungwitk-cyber/ssb-box/raw/df1df5666319cad318b28f4e81c9e03b222ea3cc/recipe2.svg"
                                        alt="">
                                </div>
                                <div>
                                    <div class="muted">Recipe name</div>
                                    <div id="clm-name" style="font-weight:600">Leafy Green 1</div>
                                </div>
                            </div>
                            <div class="divider"></div>
                            <div class="row1"><span>Air temp</span><span>= <b id="clm-air">25.0</b> ¬∞C</span></div>
                            <div class="row1"><span>RH%</span><span>= <b id="clm-rh">70</b> %</span></div>
                            <div class="row1"><span>CO‚ÇÇ</span><span>= <b id="clm-co2">1200</b> ppm</span></div>
                            <div class="row1"><span>Light</span><span>= <b id="clm-light">ON</b></span></div>
                        </div>

                        <!-- gauges -->
                        <section class="gauges">
                            <div class="gauge" id="gAir" data-min="0" data-max="40" data-precision="1" data-r1="20"
                                data-r2="27" data-c1="#3bddf6" data-c2="#5afab2" data-c3="#fc6453">
                                <div class="ring" style="--p:0">
                                    <img src="https://github.com/reungwitk-cyber/ssb-box/raw/497513610937edbe8884a21c7b8c3d916d96a5b7/icon%20temp.png"
                                        alt="Air temp">
                                    <div class="value"><span class="num">30</span><span class="unit">¬∞C</span></div>
                                </div>
                                <div class="label">Air temp</div>
                            </div>

                            <!-- RH -->
                            <div class="gauge" id="gRH" data-min="0" data-max="100" data-precision="1" data-r1="60"
                                data-r2="80" data-c1="#3bddf6" data-c2="#5afab2" data-c3="#fc6453">
                                <div class="ring" style="--p:0">
                                    <img src="https://github.com/reungwitk-cyber/ssb-box/raw/497513610937edbe8884a21c7b8c3d916d96a5b7/RH%20ICON.png"
                                        alt="RH">
                                    <div class="value"><span class="num">55</span><span class="unit">%</span></div>
                                </div>
                                <div class="label">RH%</div>
                            </div>

                            <!-- CO2 -->
                            <div class="gauge" id="gCO2" data-min="0" data-max="2200" data-precision="0" data-r1="1000"
                                data-r2="1200" data-c1="#3bddf6" data-c2="#5afab2" data-c3="#fc6453">
                                <div class="ring" style="--p:0">
                                    <img src="https://github.com/reungwitk-cyber/ssb-box/raw/497513610937edbe8884a21c7b8c3d916d96a5b7/CO2.png"
                                        alt="CO‚ÇÇ">
                                    <div class="value"><span class="num">1200</span><span class="unit">ppm</span></div>
                                </div>
                                <div class="label">CO‚ÇÇ</div>
                            </div>

                            <!-- Light (ON/OFF ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ‡∏ä‡πà‡∏ß‡∏á‡∏™‡∏µ) -->
                            <div class="gauge" id="gLight" data-min="0" data-max="1">
                                <div class="ring" style="--p:0">
                                    <img src="https://github.com/reungwitk-cyber/ssb-box/raw/497513610937edbe8884a21c7b8c3d916d96a5b7/Light.png"
                                        alt="Light">
                                    <div class="value"><span class="num">ON</span></div>
                                </div>
                                <div class="label">Light</div>
                            </div>
                        </section>
                    </div>

                    <!-- RowB placeholders -->
                    <div class="rowB">
                        <div class="cc-card">
                            <div class="h">Climate Controls</div>
                            <div class="ctrl-row">
                                <img class="icon-sm state-img"
                                    src="https://github.com/reungwitk-cyber/ssb-box/raw/57c00370db4344094aa6c268bb5f5505f1259332/AirS0.svg"
                                    alt="Air" data-state-alias="air"
                                    data-src-on="https://github.com/reungwitk-cyber/ssb-box/raw/6934e97808b5e5fe762fb3f1173ea4a6fe2e2ad8/AirS1.svg"
                                    data-src-off="https://github.com/reungwitk-cyber/ssb-box/raw/57c00370db4344094aa6c268bb5f5505f1259332/AirS0.svg">
                                <span>Air conditioner</span>

                                <div class="pill off text-center py-2 mx-3 rounded-pill shadow-sm w-auto" id="pill-air"
                                    data-alias="air" data-switch-key="airof" data-mode-topic="ssb-box/mode/air/state"
                                    data-cmd-topic="ssb-box/switch/airof/cmd"
                                    data-switch-state-topic="ssb-box/switch/airof/state" data-off-code="3">
                                    <!-- ‚Üê ‡πÇ‡∏´‡∏°‡∏î‡∏ó‡∏µ‡πà‡∏ñ‡∏∑‡∏≠‡∏ß‡πà‡∏≤ Off -->
                                    <span data-label>Off</span>
                                </div>

                                <div class="switch-inline" style="--switch-gap: 10px;">
                                    <div class="form-check form-switch m-0">
                                        <!-- üÜï ‡πÄ‡∏û‡∏¥‡πà‡∏° class="ssbbox-switch" ‡πÅ‡∏•‡∏∞ data-alias -->
                                        <input class="form-check-input switch-lg ssbbox-switch" type="checkbox" id="air"
                                            data-alias="air">
                                    </div>
                                    <label class="form-check-label mb-0">On/Off</label>
                                </div>
                            </div>

                            <div class="ctrl-row">
                                <img class="icon-sm state-img"
                                    src="https://github.com/reungwitk-cyber/ssb-box/raw/57c00370db4344094aa6c268bb5f5505f1259332/Humidifilers0.svg"
                                    alt="Humidifier" data-state-alias="humidifier"
                                    data-src-on="https://github.com/reungwitk-cyber/ssb-box/raw/6934e97808b5e5fe762fb3f1173ea4a6fe2e2ad8/Humidifilers1.svg"
                                    data-src-off="https://github.com/reungwitk-cyber/ssb-box/raw/57c00370db4344094aa6c268bb5f5505f1259332/Humidifilers0.svg">
                                <span>Humidifier</span>

                                <div class="pill off text-center py-2 mx-3 rounded-pill shadow-sm w-auto"
                                    id="pill-humidifier" data-alias="humidifier" data-switch-key="humidifierof"
                                    data-mode-topic="ssb-box/mode/humidifier/state"
                                    data-cmd-topic="ssb-box/switch/humidifierof/cmd"
                                    data-switch-state-topic="ssb-box/switch/humidifierof/state" data-off-code="3">
                                    <!-- ‚Üê ‡πÇ‡∏´‡∏°‡∏î‡∏ó‡∏µ‡πà‡∏ñ‡∏∑‡∏≠‡∏ß‡πà‡∏≤ Off -->
                                    <span data-label>Off</span>
                                </div>



                                <div class="switch-inline" style="--switch-gap: 10px;">
                                    <div class="form-check form-switch m-0">
                                        <!-- üÜï ‡πÄ‡∏û‡∏¥‡πà‡∏° class="ssbbox-switch" ‡πÅ‡∏•‡∏∞ data-alias -->
                                        <input class="form-check-input switch-lg ssbbox-switch" type="checkbox"
                                            id="humidifierSwitch" data-alias="humidifier">
                                    </div>

                                    <label class="form-check-label mb-0">On/Off</label>
                                </div>
                            </div>

                            <div class="ctrl-row">
                                <img class="icon-sm state-img"
                                    src="https://github.com/reungwitk-cyber/ssb-box/raw/497513610937edbe8884a21c7b8c3d916d96a5b7/CO2.png"
                                    alt="CO‚ÇÇ injection" data-state-alias="co2"
                                    data-src-on="https://github.com/reungwitk-cyber/ssb-box/raw/1b4a0f4fd8a36f160e7f41728d7c161a1e10899c/Co2S1.svg"
                                    data-src-off="https://github.com/reungwitk-cyber/ssb-box/raw/497513610937edbe8884a21c7b8c3d916d96a5b7/CO2.png">
                                <span>CO‚ÇÇ injection</span>

                                <div class="pill off text-center py-2 mx-3 rounded-pill shadow-sm w-auto" id="pill-co2"
                                    data-alias="co2" data-switch-key="co2of" data-mode-topic="ssb-box/mode/co2/state"
                                    data-cmd-topic="ssb-box/switch/co2of/cmd"
                                    data-switch-state-topic="ssb-box/switch/co2of/state" data-off-code="3">
                                    <!-- ‚Üê ‡πÇ‡∏´‡∏°‡∏î‡∏ó‡∏µ‡πà‡∏ñ‡∏∑‡∏≠‡∏ß‡πà‡∏≤ Off -->
                                    <span data-label>Off</span>
                                </div>

                                <div class="switch-inline" style="--switch-gap: 10px;">
                                    <div class="form-check form-switch m-0">
                                        <!-- üÜï ‡πÄ‡∏û‡∏¥‡πà‡∏° class="ssbbox-switch" ‡πÅ‡∏•‡∏∞ data-alias -->
                                        <input class="form-check-input switch-lg ssbbox-switch" type="checkbox"
                                            id="co2Switch" data-alias="co2">
                                    </div>

                                    <label class="form-check-label mb-0">On/Off</label>
                                </div>

                            </div>
                            <div class="ctrl-row ">
                                <!-- ‡∏ã‡πâ‡∏≤‡∏¢: ‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô + ‡∏ä‡∏∑‡πà‡∏≠ -->

                                <img class="icon-sm state-img"
                                    src="https://github.com/reungwitk-cyber/ssb-box/raw/57c00370db4344094aa6c268bb5f5505f1259332/Fans0.svg"
                                    alt="Duct fan" data-state-alias="ductfan"
                                    data-src-on="https://github.com/reungwitk-cyber/ssb-box/raw/6934e97808b5e5fe762fb3f1173ea4a6fe2e2ad8/Fans1.svg"
                                    data-src-off="https://github.com/reungwitk-cyber/ssb-box/raw/57c00370db4344094aa6c268bb5f5505f1259332/Fans0.svg"
                                    width="48" height="48">
                                <span>Duct fan</span>


                                <div class="pill off text-center py-2 mx-3 rounded-pill shadow-sm w-auto"
                                    id="pill-ductfan" data-alias="ductfan" data-switch-key="ductfanof"
                                    data-mode-topic="ssb-box/mode/ductfan/state"
                                    data-cmd-topic="ssb-box/switch/ductfanof/cmd"
                                    data-switch-state-topic="ssb-box/switch/ductfanof/state" data-off-code="3">
                                    <!-- ‚Üê ‡πÇ‡∏´‡∏°‡∏î‡∏ó‡∏µ‡πà‡∏ñ‡∏∑‡∏≠‡∏ß‡πà‡∏≤ Off -->
                                    <span data-label>Off</span>
                                </div>


                                <!-- ‡∏Ç‡∏ß‡∏≤: Switch On/Off -->
                                <div class="switch-inline" style="--switch-gap: 10px;">
                                    <div class="form-check form-switch m-0">
                                        <input class="form-check-input switch-lg ssbbox-switch" type="checkbox"
                                            id="ductfanSwitch" data-alias="ductfan">
                                    </div>
                                    <label class="form-check-label mb-0 ms-1" for="ductfanSwitch">On/Off</label>
                                </div>
                            </div>

                            <div class="ctrl-row">
                                <img class="icon-sm state-img"
                                    src="https://github.com/reungwitk-cyber/ssb-box/raw/57c00370db4344094aa6c268bb5f5505f1259332/ReturnFanS0.svg"
                                    alt="Return fan" data-state-alias="returnfan"
                                    data-src-on="https://github.com/reungwitk-cyber/ssb-box/raw/1b4a0f4fd8a36f160e7f41728d7c161a1e10899c/ReturnFanS1.svg"
                                    data-src-off="https://github.com/reungwitk-cyber/ssb-box/raw/57c00370db4344094aa6c268bb5f5505f1259332/ReturnFanS0.svg">
                                <span>Return fan</span>

                                <div class="pill off text-center py-2 mx-3 rounded-pill shadow-sm w-auto"
                                    id="pill-returnfan" data-alias="returnfan" data-switch-key="returnfanof"
                                    data-mode-topic="ssb-box/mode/returnfan/state"
                                    data-cmd-topic="ssb-box/switch/returnfanof/cmd"
                                    data-switch-state-topic="ssb-box/switch/returnfan/state" data-off-code="3">
                                    <!-- ‚Üê ‡πÇ‡∏´‡∏°‡∏î‡∏ó‡∏µ‡πà‡∏ñ‡∏∑‡∏≠‡∏ß‡πà‡∏≤ Off -->
                                    <span data-label>Off</span>
                                </div>

                                <div class="switch-inline" style="--switch-gap: 10px;">
                                    <div class="form-check form-switch m-0">
                                        <!-- üÜï ‡πÄ‡∏û‡∏¥‡πà‡∏° class="ssbbox-switch" ‡πÅ‡∏•‡∏∞ data-alias -->
                                        <input class="form-check-input switch-lg ssbbox-switch" type="checkbox"
                                            id="returnfanSwitch" data-alias="returnfan">
                                    </div>
                                    <label class="form-check-label mb-0">On/Off</label>
                                </div>



                            </div>

                            <div class="ctrl-row">
                                <img class="icon-sm state-img"
                                    src="https://github.com/reungwitk-cyber/ssb-box/raw/57c00370db4344094aa6c268bb5f5505f1259332/ExhaustS0.svg"
                                    alt="Exhaust fan" data-state-alias="exhaustfan"
                                    data-src-on="https://github.com/reungwitk-cyber/ssb-box/raw/1b4a0f4fd8a36f160e7f41728d7c161a1e10899c/ExhaustS1.svg"
                                    data-src-off="https://github.com/reungwitk-cyber/ssb-box/raw/57c00370db4344094aa6c268bb5f5505f1259332/ExhaustS0.svg">
                                <span>Exhaust fan</span>


                                <div class="pill off text-center py-2 mx-3 rounded-pill shadow-sm w-auto"
                                    id="pill-exhaustfan" data-alias="exhaustfan" data-switch-key="exhaustfanof"
                                    data-mode-topic="ssb-box/mode/exhaustfan/state"
                                    data-cmd-topic="ssb-box/switch/exhaustfanof/cmd"
                                    data-switch-state-topic="ssb-box/switch/exhaustfan/state" data-off-code="3">
                                    <!-- ‚Üê ‡πÇ‡∏´‡∏°‡∏î‡∏ó‡∏µ‡πà‡∏ñ‡∏∑‡∏≠‡∏ß‡πà‡∏≤ Off -->
                                    <span data-label>Off</span>
                                </div>

                                <div class="switch-inline" style="--switch-gap: 10px;">
                                    <div class="form-check form-switch m-0">
                                        <!-- üÜï ‡πÄ‡∏û‡∏¥‡πà‡∏° class="ssbbox-switch" ‡πÅ‡∏•‡∏∞ data-alias -->
                                        <input class="form-check-input switch-lg ssbbox-switch" type="checkbox"
                                            id="exhaustfanSwitch" data-alias="exhaustfan">
                                    </div>
                                    <label class="form-check-label mb-0">On/Off</label>
                                </div>
                            </div>

                            <div class="ctrl-row">
                                <img class="icon-sm state-img"
                                    src="https://github.com/reungwitk-cyber/ssb-box/raw/57c00370db4344094aa6c268bb5f5505f1259332/Fans0.svg"
                                    alt="Nursery Fan : Upper" data-state-alias="nurseryfanupper"
                                    data-src-on="https://github.com/reungwitk-cyber/ssb-box/raw/6934e97808b5e5fe762fb3f1173ea4a6fe2e2ad8/Fans1.svg"
                                    data-src-off="https://github.com/reungwitk-cyber/ssb-box/raw/57c00370db4344094aa6c268bb5f5505f1259332/Fans0.svg">
                                <span class="ctrl-title">Nursery Fan : <span>Upper</span></span>

                                <div class="pill off text-center py-2 mx-3 rounded-pill shadow-sm w-auto"
                                    id="pill-nurseryfanupper" data-alias="nurseryfanupper"
                                    data-switch-key="nurseryfanupperof"
                                    data-mode-topic="ssb-box/mode/nurseryfanupper/state"
                                    data-cmd-topic="ssb-box/switch/nurseryfanupperof/cmd"
                                    data-switch-state-topic="ssb-box/switch/nurseryfanupper/state" data-off-code="3">
                                    <!-- ‚Üê ‡πÇ‡∏´‡∏°‡∏î‡∏ó‡∏µ‡πà‡∏ñ‡∏∑‡∏≠‡∏ß‡πà‡∏≤ Off -->
                                    <span data-label>Off</span>
                                </div>

                                <div class="switch-inline" style="--switch-gap: 10px;">
                                    <div class="form-check form-switch m-0">
                                        <!-- üÜï ‡πÄ‡∏û‡∏¥‡πà‡∏° class="ssbbox-switch" ‡πÅ‡∏•‡∏∞ data-alias -->
                                        <input class="form-check-input switch-lg ssbbox-switch" type="checkbox"
                                            id="nurseryfanupperSwitch" data-alias="nurseryfanupper">
                                    </div>
                                    <label class="form-check-label mb-0">On/Off</label>
                                </div>



                            </div>

                            <div class="ctrl-row">
                                <img class="icon-sm state-img"
                                    src="https://github.com/reungwitk-cyber/ssb-box/raw/57c00370db4344094aa6c268bb5f5505f1259332/Fans0.svg"
                                    alt="Nursery Fan : Lower" data-state-alias="nurseryfanlower"
                                    data-src-on="https://github.com/reungwitk-cyber/ssb-box/raw/6934e97808b5e5fe762fb3f1173ea4a6fe2e2ad8/Fans1.svg"
                                    data-src-off="https://github.com/reungwitk-cyber/ssb-box/raw/57c00370db4344094aa6c268bb5f5505f1259332/Fans0.svg">
                                <span class="ctrl-title">Nursery Fan : <span>Lower</span></span>


                                <div class="pill off text-center py-2 mx-3 rounded-pill shadow-sm w-auto"
                                    id="pill-nurseryfanlower" data-alias="nurseryfanlower"
                                    data-switch-key="nurseryfanlowerof"
                                    data-mode-topic="ssb-box/mode/nurseryfanlower/state"
                                    data-cmd-topic="ssb-box/switch/nurseryfanlowerof/cmd"
                                    data-switch-state-topic="ssb-box/switch/nurseryfanlower/state" data-off-code="3">
                                    <!-- ‚Üê ‡πÇ‡∏´‡∏°‡∏î‡∏ó‡∏µ‡πà‡∏ñ‡∏∑‡∏≠‡∏ß‡πà‡∏≤ Off -->
                                    <span data-label>Off</span>
                                </div>

                                <div class="switch-inline" style="--switch-gap: 10px;">
                                    <div class="form-check form-switch m-0">
                                        <!-- üÜï ‡πÄ‡∏û‡∏¥‡πà‡∏° class="ssbbox-switch" ‡πÅ‡∏•‡∏∞ data-alias -->
                                        <input class="form-check-input switch-lg ssbbox-switch" type="checkbox"
                                            id="nurseryfanlowerSwitch" data-alias="nurseryfanlower">
                                    </div>
                                    <label class="form-check-label mb-0">On/Off</label>
                                </div>
                            </div>
                            <!-- agitator 1-->
                            <div class="ctrl-row">
                                <img class="icon-sm state-img"
                                    src="https://github.com/reungwitk-cyber/ssb-box/raw/8360faa12f4a8b86ccaa05d48f7b1fa126fd4f12/AgtatorS0.svg"
                                    alt="Agitator Section1‚Äì2" data-state-alias="agitator1-2"
                                    data-src-on="https://github.com/reungwitk-cyber/ssb-box/raw/8360faa12f4a8b86ccaa05d48f7b1fa126fd4f12/AgtatorS1.svg"
                                    data-src-off="https://github.com/reungwitk-cyber/ssb-box/raw/8360faa12f4a8b86ccaa05d48f7b1fa126fd4f12/AgtatorS0.svg">
                                <span class="ctrl-title">Agitator : <span>Section1‚Äì2</span></span>

                                <div class="pill off text-center py-2 mx-3 rounded-pill shadow-sm w-auto"
                                    id="pill-agitator1-2in" data-alias="agitator1-2" data-switch-key="agitator1-2of"
                                    data-mode-topic="ssb-box/mode/agitator1-2/state"
                                    data-cmd-topic="ssb-box/switch/agitator1-2of/cmd"
                                    data-switch-state-topic="ssb-box/switch/agitator1-2in/state" data-off-code="3">
                                    <span data-label>Off</span>
                                </div>

                                <div class="switch-inline stack">
                                    <div class="form-check form-switch m-0">
                                        <input class="form-check-input switch-lg ssbbox-switch" type="checkbox"
                                            id="agitator1-2in" data-alias="agitator1-2in">
                                        <label class="form-check-label mb-0 ms-2">move_In</label>
                                    </div>
                                    <div class="form-check form-switch m-0">
                                        <input class="form-check-input switch-lg ssbbox-switch" type="checkbox"
                                            id="agitator1-2out" data-alias="agitator1-2out">
                                        <label class="form-check-label mb-0 ms-2">moveOut</label>
                                    </div>
                                </div>
                            </div>


                            <!-- agitator 2-->
                            <div class="ctrl-row">
                                <img class="icon-sm state-img"
                                    src="https://github.com/reungwitk-cyber/ssb-box/raw/8360faa12f4a8b86ccaa05d48f7b1fa126fd4f12/AgtatorS0.svg"
                                    alt="Agitator Section3‚Äì4" data-state-alias="agitator3-4"
                                    data-src-on="https://github.com/reungwitk-cyber/ssb-box/raw/8360faa12f4a8b86ccaa05d48f7b1fa126fd4f12/AgtatorS1.svg"
                                    data-src-off="https://github.com/reungwitk-cyber/ssb-box/raw/8360faa12f4a8b86ccaa05d48f7b1fa126fd4f12/AgtatorS0.svg">
                                <span class="ctrl-title">Agitator : <span>Section3‚Äì4</span></span>

                                <div class="pill off text-center py-2 mx-3 rounded-pill shadow-sm w-auto"
                                    id="pill-agitator3-4in" data-alias="agitator3-4" data-switch-key="agitator3-4of"
                                    data-mode-topic="ssb-box/mode/agitator3-4/state"
                                    data-cmd-topic="ssb-box/switch/agitator3-4of/cmd"
                                    data-switch-state-topic="ssb-box/switch/agitator3-4in/state" data-off-code="3">
                                    <span data-label>Off</span>
                                </div>

                                <div class="switch-inline stack">
                                    <div class="form-check form-switch m-0">
                                        <input class="form-check-input switch-lg ssbbox-switch" type="checkbox"
                                            id="agitator3-4in" data-alias="agitator3-4in">
                                        <label class="form-check-label mb-0 ms-2">move_In</label>
                                    </div>
                                    <div class="form-check form-switch m-0">
                                        <input class="form-check-input switch-lg ssbbox-switch" type="checkbox"
                                            id="agitator3-4out" data-alias="agitator3-4out">
                                        <label class="form-check-label mb-0 ms-2">moveOut</label>
                                    </div>
                                </div>
                            </div>

                        </div>

                        <div class="cc-card">
                            <div class="h">Light Setting</div>
                            <div class="light-row"><img class="icon-smd"
                                    src="https://github.com/reungwitk-cyber/ssb-box/raw/60952953ff1871957cf5642ee8436ad318649e5a/Dayicon.svg"
                                    alt=""><span>Start <input type="time" value="06:00"></span><span>End
                                    <input type="time" value="22:00"></span><b>16 Hrs</b></div>
                            <div class="light-row"><img class="icon-smd"
                                    src="https://github.com/reungwitk-cyber/ssb-box/raw/60952953ff1871957cf5642ee8436ad318649e5a/nighticon.svg"
                                    alt=""><span>Start <input type="time" value="22:01"></span><span>End <input
                                        type="time" value="06:00"></span><b>8
                                    Hrs</b></div>
                            <!-- ‚Üê Row1 -->
                            <div class="ctrl-row">
                                <img class="icon-sm state-img"
                                    src="https://github.com/reungwitk-cyber/ssb-box/raw/3e25a9b3596d13c5522c57d6382d3e76db44ac8e/LampRow0.svg"
                                    alt="ledrow1" data-state-alias="ledrow1"
                                    data-src-on="https://github.com/reungwitk-cyber/ssb-box/raw/3e25a9b3596d13c5522c57d6382d3e76db44ac8e/LampRow1.svg"
                                    data-src-off="https://github.com/reungwitk-cyber/ssb-box/raw/3e25a9b3596d13c5522c57d6382d3e76db44ac8e/LampRow0.svg">
                                <span>Ledrow1</span>

                                <div class="pill off text-center py-2 mx-3 rounded-pill shadow-sm w-auto"
                                    id="pill-ledrow1" data-alias="ledrow1" data-switch-key="ledrow1of"
                                    data-mode-topic="ssb-box/mode/ledrow1/state"
                                    data-cmd-topic="ssb-box/switch/ledrow1of/cmd"
                                    data-switch-state-topic="ssb-box/switch/ledrow1of/state" data-off-code="3">
                                    <!-- ‚Üê ‡πÇ‡∏´‡∏°‡∏î‡∏ó‡∏µ‡πà‡∏ñ‡∏∑‡∏≠‡∏ß‡πà‡∏≤ Off -->
                                    <span data-label>Off</span>
                                </div>

                                <div class="switch-inline" style="--switch-gap: 10px;">
                                    <div class="form-check form-switch m-0">
                                        <!-- üÜï ‡πÄ‡∏û‡∏¥‡πà‡∏° class="ssbbox-switch" ‡πÅ‡∏•‡∏∞ data-alias -->
                                        <input class="form-check-input switch-lg ssbbox-switch" type="checkbox"
                                            id="ledrow1switch" data-alias="ledrow1">
                                    </div>

                                    <label class="form-check-label mb-0">On/Off</label>
                                </div>

                            </div>


                            <!-- ‚Üê Row2 -->
                            <div class="ctrl-row">
                                <img class="icon-sm state-img"
                                    src="https://github.com/reungwitk-cyber/ssb-box/raw/3e25a9b3596d13c5522c57d6382d3e76db44ac8e/LampRow0.svg"
                                    alt="ledrow2" data-state-alias="ledrow2"
                                    data-src-on="https://github.com/reungwitk-cyber/ssb-box/raw/3e25a9b3596d13c5522c57d6382d3e76db44ac8e/LampRow1.svg"
                                    data-src-off="https://github.com/reungwitk-cyber/ssb-box/raw/3e25a9b3596d13c5522c57d6382d3e76db44ac8e/LampRow0.svg">
                                <span>Ledrow2</span>

                                <div class="pill off text-center py-2 mx-3 rounded-pill shadow-sm w-auto"
                                    id="pill-ledrow2" data-alias="ledrow2" data-switch-key="ledrow2of"
                                    data-mode-topic="ssb-box/mode/ledrow2/state"
                                    data-cmd-topic="ssb-box/switch/ledrow2of/cmd"
                                    data-switch-state-topic="ssb-box/switch/ledrow2/state" data-off-code="3">
                                    <!-- ‚Üê ‡πÇ‡∏´‡∏°‡∏î‡∏ó‡∏µ‡πà‡∏ñ‡∏∑‡∏≠‡∏ß‡πà‡∏≤ Off -->
                                    <span data-label>Off</span>
                                </div>

                                <div class="switch-inline" style="--switch-gap: 10px;">
                                    <div class="form-check form-switch m-0">
                                        <!-- üÜï ‡πÄ‡∏û‡∏¥‡πà‡∏° class="ssbbox-switch" ‡πÅ‡∏•‡∏∞ data-alias -->
                                        <input class="form-check-input switch-lg ssbbox-switch" type="checkbox"
                                            id="ledrow2switch" data-alias="ledrow2">
                                    </div>

                                    <label class="form-check-label mb-0">On/Off</label>
                                </div>
                            </div>
                            <!-- ‚Üê Row3 -->
                            <div class="ctrl-row">
                                <img class="icon-sm state-img"
                                    src="https://github.com/reungwitk-cyber/ssb-box/raw/3e25a9b3596d13c5522c57d6382d3e76db44ac8e/LampRow0.svg"
                                    alt="ledrow3" data-state-alias="ledrow3"
                                    data-src-on="https://github.com/reungwitk-cyber/ssb-box/raw/3e25a9b3596d13c5522c57d6382d3e76db44ac8e/LampRow1.svg"
                                    data-src-off="https://github.com/reungwitk-cyber/ssb-box/raw/3e25a9b3596d13c5522c57d6382d3e76db44ac8e/LampRow0.svg">
                                <span>Ledrow3</span>

                                <div class="pill off text-center py-2 mx-3 rounded-pill shadow-sm w-auto"
                                    id="pill-ledrow3" data-alias="ledrow3" data-switch-key="ledrow3of"
                                    data-mode-topic="ssb-box/mode/ledrow3/state"
                                    data-cmd-topic="ssb-box/switch/ledrow3of/cmd"
                                    data-switch-state-topic="ssb-box/switch/ledrow3/state" data-off-code="3">
                                    <!-- ‚Üê ‡πÇ‡∏´‡∏°‡∏î‡∏ó‡∏µ‡πà‡∏ñ‡∏∑‡∏≠‡∏ß‡πà‡∏≤ Off -->
                                    <span data-label>Off</span>
                                </div>

                                <div class="switch-inline" style="--switch-gap: 10px;">
                                    <div class="form-check form-switch m-0">
                                        <!-- üÜï ‡πÄ‡∏û‡∏¥‡πà‡∏° class="ssbbox-switch" ‡πÅ‡∏•‡∏∞ data-alias -->
                                        <input class="form-check-input switch-lg ssbbox-switch" type="checkbox"
                                            id="ledrow3switch" data-alias="ledrow3">
                                    </div>

                                    <label class="form-check-label mb-0">On/Off</label>
                                </div>
                            </div>
                            <!-- ‚Üê Row4 -->
                            <div class="ctrl-row">
                                <img class="icon-sm state-img"
                                    src="https://github.com/reungwitk-cyber/ssb-box/raw/3e25a9b3596d13c5522c57d6382d3e76db44ac8e/LampRow0.svg"
                                    alt="ledrow4" data-state-alias="ledrow4"
                                    data-src-on="https://github.com/reungwitk-cyber/ssb-box/raw/3e25a9b3596d13c5522c57d6382d3e76db44ac8e/LampRow1.svg"
                                    data-src-off="https://github.com/reungwitk-cyber/ssb-box/raw/3e25a9b3596d13c5522c57d6382d3e76db44ac8e/LampRow0.svg">
                                <span>Ledrow4</span>

                                <div class="pill off text-center py-2 mx-3 rounded-pill shadow-sm w-auto"
                                    id="pill-ledrow4" data-alias="ledrow4" data-switch-key="ledrow4of"
                                    data-mode-topic="ssb-box/mode/Ledrow4/state"
                                    data-cmd-topic="ssb-box/switch/ledrow4of/cmd"
                                    data-switch-state-topic="ssb-box/switch/ledrow4/state" data-off-code="3">
                                    <!-- ‚Üê ‡πÇ‡∏´‡∏°‡∏î‡∏ó‡∏µ‡πà‡∏ñ‡∏∑‡∏≠‡∏ß‡πà‡∏≤ Off -->
                                    <span data-label>Off</span>
                                </div>

                                <div class="switch-inline" style="--switch-gap: 10px;">
                                    <div class="form-check form-switch m-0">
                                        <!-- üÜï ‡πÄ‡∏û‡∏¥‡πà‡∏° class="ssbbox-switch" ‡πÅ‡∏•‡∏∞ data-alias -->
                                        <input class="form-check-input switch-lg ssbbox-switch" type="checkbox"
                                            id="ledrow4switch" data-alias="ledrow4">
                                    </div>

                                    <label class="form-check-label mb-0">On/Off</label>
                                </div>
                            </div>

                            <!-- ‚Üê Lamp upper -->
                            <div class="ctrl-row">
                                <img class="icon-sm state-img"
                                    src="https://github.com/reungwitk-cyber/ssb-box/raw/6ddb716a15605e5a023bc1ef59f5328abcc86bf5/Lampup0.svg"
                                    alt="Lamp upper injection" data-state-alias="nursery-ledupper"
                                    data-src-on="https://github.com/reungwitk-cyber/ssb-box/raw/6ddb716a15605e5a023bc1ef59f5328abcc86bf5/Lampup1.svg"
                                    data-src-off="https://github.com/reungwitk-cyber/ssb-box/raw/6ddb716a15605e5a023bc1ef59f5328abcc86bf5/Lampup0.svg">
                                <span>Lamp upper</span>

                                <div class="pill off text-center py-2 mx-3 rounded-pill shadow-sm w-auto"
                                    id="pill-nursery-ledupper" data-alias="nursery-ledupper"
                                    data-switch-key="nursery-ledupperof"
                                    data-mode-topic="ssb-box/mode/nursery-ledupper/state"
                                    data-cmd-topic="ssb-box/switch/nursery-ledupperof/cmd"
                                    data-switch-state-topic="ssb-box/switch/nursery-ledupperof/state" data-off-code="3">
                                    <!-- ‚Üê ‡πÇ‡∏´‡∏°‡∏î‡∏ó‡∏µ‡πà‡∏ñ‡∏∑‡∏≠‡∏ß‡πà‡∏≤ Off -->
                                    <span data-label>Off</span>
                                </div>

                                <div class="switch-inline" style="--switch-gap: 10px;">
                                    <div class="form-check form-switch m-0">
                                        <!-- üÜï ‡πÄ‡∏û‡∏¥‡πà‡∏° class="ssbbox-switch" ‡πÅ‡∏•‡∏∞ data-alias -->
                                        <input class="form-check-input switch-lg ssbbox-switch" type="checkbox"
                                            id="nursery-ledupperSwitch" data-alias="nursery-ledupper">
                                    </div>

                                    <label class="form-check-label mb-0">On/Off</label>
                                </div>

                            </div>
                            <!-- ‚Üê Lamp lower -->
                            <div class="ctrl-row">
                                <img class="icon-sm state-img"
                                    src="https://github.com/reungwitk-cyber/ssb-box/raw/6ddb716a15605e5a023bc1ef59f5328abcc86bf5/Lampup0.svg"
                                    alt="Lamp lower injection" data-state-alias="nursery-ledlower"
                                    data-src-on="https://github.com/reungwitk-cyber/ssb-box/raw/6ddb716a15605e5a023bc1ef59f5328abcc86bf5/Lampup1.svg"
                                    data-src-off="https://github.com/reungwitk-cyber/ssb-box/raw/6ddb716a15605e5a023bc1ef59f5328abcc86bf5/Lampup0.svg">
                                <span>Lamp lower</span>

                                <div class="pill off text-center py-2 mx-3 rounded-pill shadow-sm w-auto"
                                    id="pill-nursery-ledupper" data-alias="nursery-ledlower"
                                    data-switch-key="nursery-ledlowerof"
                                    data-mode-topic="ssb-box/mode/nursery-ledlower/state"
                                    data-cmd-topic="ssb-box/switch/nursery-ledlowerof/cmd"
                                    data-switch-state-topic="ssb-box/switch/nursery-ledlowerof/state" data-off-code="3">
                                    <!-- ‚Üê ‡πÇ‡∏´‡∏°‡∏î‡∏ó‡∏µ‡πà‡∏ñ‡∏∑‡∏≠‡∏ß‡πà‡∏≤ Off -->
                                    <span data-label>Off</span>
                                </div>

                                <div class="switch-inline" style="--switch-gap: 10px;">
                                    <div class="form-check form-switch m-0">
                                        <!-- üÜï ‡πÄ‡∏û‡∏¥‡πà‡∏° class="ssbbox-switch" ‡πÅ‡∏•‡∏∞ data-alias -->
                                        <input class="form-check-input switch-lg ssbbox-switch" type="checkbox"
                                            id="nursery-ledlowerSwitch" data-alias="nursery-ledlower">
                                    </div>

                                    <label class="form-check-label mb-0">On/Off</label>

                                </div>

                            </div>







                        </div>

                        <div class="cc-card">
                            <div class="h">Climate Set point</div>
                            <div class="sp-row"><img class="icon-sm"
                                    src="https://github.com/reungwitk-cyber/ssb-box/raw/136c5650822e9408fff8afce299e96f49001fb45/tempiconday.svg"
                                    alt=""><span>Day Temp.</span><input type="number" value="25"> ¬∞C</div>
                            <div class="sp-row"><img class="icon-sm"
                                    src="https://github.com/reungwitk-cyber/ssb-box/raw/136c5650822e9408fff8afce299e96f49001fb45/tempiconnight.svg"
                                    alt=""><span>Night Temp.</span><input type="number" value="23"> ¬∞C</div>
                            <div class="sp-row"><img class="icon-sm"
                                    src="https://github.com/reungwitk-cyber/ssb-box/raw/136c5650822e9408fff8afce299e96f49001fb45/Co2iconDay.svg"
                                    alt=""><span>CO‚ÇÇ Day</span><input type="number" value="1200"> ppm</div>

                            <div class="sp-row"><img class="icon-sm"
                                    src="https://github.com/reungwitk-cyber/ssb-box/raw/136c5650822e9408fff8afce299e96f49001fb45/Humday.svg"
                                    alt=""><span>RH Day</span><input type="number" value="65"> %</div>
                            <div class="sp-row"><img class="icon-sm"
                                    src="https://github.com/reungwitk-cyber/ssb-box/raw/136c5650822e9408fff8afce299e96f49001fb45/Humnight.svg"
                                    alt=""><span>RH Night</span><input type="number" value="80"> %</div>
                        </div>
                    </div>
                </section>
            </div>
        </main>

    </div>

    <!-- ================= CLOCK ================= -->
    <script>
        // ‡πÅ‡∏™‡∏î‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà+‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏ö‡∏ö real-time
        const dateText = document.getElementById('dateText'),
            timeText = document.getElementById('timeText');

        function pad(n) { return String(n).padStart(2, '0'); }

        function fmt() {
            const d = new Date(), day = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            if (dateText) dateText.textContent =
                `${day[d.getDay()]}. ${pad(d.getDate())} - ${pad(d.getMonth() + 1)} - ${String(d.getFullYear()).slice(-2)}`;
            if (timeText) timeText.textContent =
                `Time - ${pad(d.getHours())}:${pad(d.getMinutes())}:${pad(d.getSeconds())}`;
        }
        fmt();
        setInterval(fmt, 1000);
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <!-- ================= GAUGE ================= -->
    <script>
        // ‡∏ä‡πà‡∏ß‡∏¢‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤‡∏ï‡∏±‡∏ß‡πÅ‡∏£‡∏Å‡∏à‡∏≤‡∏Å array ‡∏´‡∏£‡∏∑‡∏≠‡πÅ‡∏õ‡∏•‡∏á string ‚Üí number
        function first(v, fb = null) { /*‡∏ü‡∏±‡∏á‡∏ä‡∏±‡∏ô first ‡∏°‡∏µ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ v ‡πÄ‡πÄ‡∏•‡∏∞ fb = ‡∏ß‡πà‡∏≤‡∏á*/
            if (Array.isArray(v) && v.length) { /*Array.isArray(v) ‚Üí ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤ v ‡πÄ‡∏õ‡πá‡∏ô array ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà v.length ‚Üí ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤ array ‡∏°‡∏µ‡∏Ç‡∏≠‡∏á‡∏Ç‡πâ‡∏≤‡∏á‡πÉ‡∏ô‡πÑ‡∏´‡∏°*/
                return Number(v[0]); /*v = ["25.7"] ‚Üí ‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤ 25.7*/
            } else if (Number.isFinite(Number(v))) { /*‡∏à‡∏∞‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤ ‚Äú‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡πÅ‡∏õ‡∏•‡∏á‡∏≠‡∏≠‡∏Å‡∏°‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏•‡∏Ç‡∏à‡∏£‡∏¥‡∏á‡πÑ‡∏´‡∏° (‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà NaN, ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà Infinity)‚Äù*/
                return Number(v); /*‡∏ñ‡πâ‡∏≤ v = "20.5" ‚Üí ‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤ 20.5*/
            } else {
                return fb; /*‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡πÄ‡∏•‡∏¢ ‡∏à‡∏∞‡∏™‡πà‡∏á fb*/
            }
        }
        /*‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û function first
        first([ "27.3" ]);     // ‚úÖ ‡πÑ‡∏î‡πâ 27.3
        first("45");           // ‚úÖ ‡πÑ‡∏î‡πâ 45
        first(12.5);           // ‚úÖ ‡πÑ‡∏î‡πâ 12.5
        first("abc");          // ‚ùå ‡πÑ‡∏î‡πâ null (‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏•‡∏Ç‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ)
        first("abc", 0);       // ‚úÖ ‡πÑ‡∏î‡πâ 0 (‡πÉ‡∏ä‡πâ fallback)*/


        // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ä‡πà‡∏ß‡∏á‡∏™‡∏µ (low, mid, high)
        function getColorRanges(el, min, max) {
            const r1 = Number(el?.dataset.r1), r2 = Number(el?.dataset.r2);
            const c1 = el?.dataset.c1 || '#3b82f6',
                c2 = el?.dataset.c2 || '#10b981',
                c3 = el?.dataset.c3 || '#ef4444';
            const cut1 = Number.isFinite(r1) ? r1 : (min + (max - min) * 0.33);
            const cut2 = Number.isFinite(r2) ? r2 : (min + (max - min) * 0.66);
            return [
                { min, max: cut1, color: c1 },
                { min: cut1, max: cut2, color: c2 },
                { min: cut2, max, color: c3 }
            ];
        }

        // ‡πÉ‡∏™‡πà‡∏™‡∏µ‡πÄ‡∏Å‡∏à‡∏ï‡∏≤‡∏°‡∏Ñ‡πà‡∏≤
        function setGaugeColor(ring, val, ranges) {
            for (const r of ranges) {
                if (val >= r.min && val <= r.max) {
                    ring?.style.setProperty('--progress', r.color);
                    return;
                }
            }
            if (ranges?.length) ring?.style.setProperty('--progress', ranges[ranges.length - 1].color);
        }

        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÄ‡∏Å‡∏à (‡∏£‡∏ß‡∏° clamp ‡∏Å‡∏±‡∏ô‡∏Ñ‡πà‡∏≤‡∏´‡∏•‡∏∏‡∏î‡∏ä‡πà‡∏ß‡∏á)
        function setGauge(gaugeEl, value) {/*gaugeEl = element ‡∏Ç‡∏≠‡∏á‡πÄ‡∏Å‡∏à‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö (‡πÄ‡∏ä‡πà‡∏ô <div id="gAir">‚Ä¶</div> , value ‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å websoket*/
            if (!gaugeEl) return; /*‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö ‡∏à‡∏∞ ‡∏≠‡∏≠‡∏Å‡∏ü‡∏±‡∏á‡∏ä‡∏±‡πâ‡∏ô*/
            const min = Number(gaugeEl.dataset.min || 0), /*‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡πà‡∏≤ min ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î = 0 ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á <div id="gAir" data-min="10" data-max="40"></div>*/
                max = Number(gaugeEl.dataset.max || 100);
            const ring = gaugeEl.querySelector('.ring'), /**/
                numEl = gaugeEl.querySelector('.num');
            const nVal = Number(value);

            const clamped = Math.max(min, Math.min(max, nVal));
            const pct = Math.max(0, Math.min(1, (clamped - min) / (max - min))) * 100;
            ring?.style.setProperty('--p', pct.toFixed(2));

            if (gaugeEl.id === 'gLight') {
                if (numEl) numEl.textContent = (clamped >= 0.5) ? 'ON' : 'OFF';
                ring?.style.setProperty('--progress',
                    (clamped >= 0.5) ? (gaugeEl.dataset.c2 || '#22c55e') : (gaugeEl.dataset.c1 || '#a1a1aa'));
            } else {
                if (numEl) numEl.textContent = clamped.toFixed(Number(gaugeEl.dataset.precision || 1));
                setGaugeColor(ring, clamped, getColorRanges(gaugeEl, min, max));
            }

            // ‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡πà‡∏≤‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏î‡πâ‡∏≤‡∏ô‡∏Ç‡πâ‡∏≤‡∏á‡∏î‡πâ‡∏ß‡∏¢
            if (gaugeEl.id === 'gAir') document.getElementById('clm-air').textContent = clamped.toFixed(1);
            if (gaugeEl.id === 'gRH') document.getElementById('clm-rh').textContent = clamped.toFixed(0);
            if (gaugeEl.id === 'gCO2') document.getElementById('clm-co2').textContent = clamped.toFixed(0);
            if (gaugeEl.id === 'gLight') document.getElementById('clm-light').textContent = (clamped >= 0.5 ? 'ON' : 'OFF');
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏£‡∏ß‡∏° ‡πÉ‡∏ä‡πâ‡∏ï‡∏≠‡∏ô payload sensor ‡∏°‡∏≤‡∏ñ‡∏∂‡∏á *‡∏£‡∏±‡∏ö‡∏°‡∏≤‡∏à‡∏≤‡∏Å WebSocket 
        function handleSensorPayload(p) { /*‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ p ‡∏Ñ‡∏∑‡∏≠ ‚Äúpayload‚Äù (‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡∏°‡∏≤‡∏à‡∏≤‡∏Å‡πÄ‡∏ã‡∏ô‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î)*/
            /*p = {
                BackrooomTemp: ["27.5"],
                Backrooomhumidity: ["55"],
                BackrooomCo2: ["860"],
                 Light: [1]
                };) */
            /*‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ ‡∏ü‡∏±‡∏á‡∏ä‡∏±‡∏ô first */
            const air = first(p.BackrooomTemp), /*p.BackrooomTemp ‡∏Ñ‡∏∑‡∏≠ ["27.5"] ‡∏à‡∏∞‡πÑ‡∏õ‡πÄ‡πÄ‡∏ó‡∏ô‡∏Ñ‡πà‡∏≤ v ‡πÉ‡∏ô funtion first */
                rh = first(p.Backrooomhumidity),
                co2 = first(p.BackrooomCo2);
            /*‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á ‡∏ú‡∏•‡∏•‡∏±‡∏û
                air = 27.5;
                rh  = 55;
                co2 = 860;*/

            if (air != null) setGauge(document.getElementById('gAir'), air); /*document.getElementById('gAir') ‡∏Ñ‡∏∑‡∏≠‡∏ô‡∏≥‡∏Ñ‡πà‡∏≤‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÇ‡∏õ‡∏£‡πÄ‡πÄ‡∏Å‡∏£‡∏°‡∏ô‡∏µ‡πâ‡∏ä‡∏∑‡πà‡∏≠ <div id="gAir"> ‡∏°‡∏≤‡πÉ‡∏ä‡πâ ‡∏™‡πà‡∏ß‡∏ô air ‡∏Ñ‡∏∑‡∏≠‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å websokect */
            if (rh != null) setGauge(document.getElementById('gRH'), rh);
            if (co2 != null) setGauge(document.getElementById('gCO2'), co2);
            // const light=first(p.Light); if(light!=null) setGauge(document.getElementById('gLight'), light);
        }
    </script>


    <!-- ================= DEVICE STATE ================= -->
    <script>
        const DEVICE_STATE = Object.create(null); // ‡πÄ‡∏Å‡πá‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ runtime ‡∏Ç‡∏≠‡∏á‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå
        const MODE_STATE = Object.create(null); // ‡πÄ‡∏Å‡πá‡∏ö‡∏Ñ‡πà‡∏≤ ssb-box/mode/<alias>/state

        // decode alias ‡∏à‡∏≤‡∏Å topic ‡πÄ‡∏ä‡πà‡∏ô ssb-box/(lamp|switch)/ductfan/state ‚Üí "ductfan"
        function aliasFromTopic(topic) {
            const p = String(topic || '').split('/');
            return (p.length >= 4 && p[0] === 'ssb-box' &&
                (p[1] === 'lamp' || p[1] === 'switch') &&
                p[p.length - 1] === 'state') ? p[2] : null;
        }

        // decode payload ‚Üí scalar
        function scalarFromPayload(alias, payload) {
            if (payload == null) return null;
            if (typeof payload === 'string') { try { return scalarFromPayload(alias, JSON.parse(payload)); } catch { } }
            if (Array.isArray(payload)) return payload.length ? payload[0] : null;
            if (typeof payload === 'object') {
                if (alias in payload) return Array.isArray(payload[alias]) ? payload[alias][0] : payload[alias];
                const outKey = `output-${alias}`;
                if (outKey in payload) return Array.isArray(payload[outKey]) ? payload[outKey][0] : payload[outKey];
                if ('value' in payload) return Array.isArray(payload.value) ? payload.value[0] : payload.value;
                const ks = Object.keys(payload);
                if (ks.length === 1) { let v = payload[ks[0]]; return Array.isArray(v) ? v[0] : v; }
            }
            if (typeof payload === 'boolean' || typeof payload === 'number') return payload;
            if (!Number.isNaN(Number(payload))) return Number(payload);
            if (payload === 'true') return true;
            if (payload === 'false') return false;
            return payload;
        }

        // ‡πÉ‡∏ä‡πâ‡πÅ‡∏õ‡∏•‡∏á‡∏Ñ‡πà‡∏≤‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô boolean
        function toBool(v) {
            if (Array.isArray(v)) v = v[0];
            if (typeof v === 'string') {
                const s = v.toLowerCase();
                if (['true', 'on', '1'].includes(s)) return true;
                if (['false', 'off', '0'].includes(s)) return false;
            }
            if (typeof v === 'number') return v !== 0;
            return !!v;
        }

        // sync ‡∏£‡∏π‡∏õ icon
        function updateImagesByAlias(alias, val) {
            const isOn = toBool(val);
            document.querySelectorAll(`img.state-img[data-state-alias="${alias}"]`).forEach(img => {
                if (isOn && img.dataset.srcOn) img.src = img.dataset.srcOn;
                if (!isOn && img.dataset.srcOff) img.src = img.dataset.srcOff;
                img.classList.toggle('is-on', isOn);
                img.classList.toggle('is-off', !isOn);
            });
        }

        // ‚úÖ ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö "payload ‡∏•‡πâ‡∏ß‡∏ô" ‡πÄ‡∏ä‡πà‡∏ô { "ductfan":[false], "exhaustfan":[true] }
        // üîß ‡πÑ‡∏°‡πà‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏£‡∏π‡∏õ‡∏à‡∏≤‡∏Å payload ‡∏´‡∏•‡∏ß‡∏° ‡πÜ (‡πÑ‡∏°‡πà‡∏£‡∏π‡πâ‡∏ß‡πà‡∏≤ lamp ‡∏´‡∏£‡∏∑‡∏≠ switch) ‚Äî ‡πÉ‡∏´‡πâ‡∏£‡∏π‡∏õ‡∏ü‡∏±‡∏á‡∏à‡∏≤‡∏Å lamp ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
        function handleLooseStatePayload(obj) {
            if (!obj || typeof obj !== 'object' || Array.isArray(obj)) return;
            Object.entries(obj).forEach(([alias, val]) => {
                let v = val;
                if (Array.isArray(v)) v = v.length ? v[0] : null;
                if (typeof v === 'string') {
                    const s = v.trim().toLowerCase();
                    if (['true', 'on', '1'].includes(s)) v = true;
                    else if (['false', 'off', '0'].includes(s)) v = false;
                    else if (!Number.isNaN(Number(v))) v = Number(v);
                }
                DEVICE_STATE[alias] = v;
                // ‚ùå ‡πÑ‡∏°‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏Å updateImagesByAlias ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà
                document.dispatchEvent(new CustomEvent('ssbbox:state', {
                    detail: { alias, value: v, topic: '' }
                }));
            });
        }
    </script>

    <!-- ================= ANTI-RACE SWITCH ================= -->
    <script>
        (function () {
            function log(...a) { console.log("[SW]", ...a); }
            window.SSB_SWITCH_TOPICS = window.SSB_SWITCH_TOPICS || new Set();

            // subscribe state topic ‡∏Ç‡∏≠‡∏á‡∏™‡∏ß‡∏¥‡∏ï‡∏ä‡πå
            function subscribeStateTopic(alias) {
                const t = `ssb-box/switch/${alias}/state`;
                window.SSB_SWITCH_TOPICS.add(t);
                if (typeof safeSubscribe === 'function') { try { safeSubscribe([t]); } catch { } }
            }

            const confirmedModes = new Map(), pendingTimers = new Map(), pendingSeq = new Map();
            const desiredMap = new Map();
            const PENDING_MS = 5000;

            function getPrevChecked(alias, fallback) {
                if (typeof DEVICE_STATE?.[alias] !== 'undefined') return !!DEVICE_STATE[alias];
                if (confirmedModes.has(alias)) return confirmedModes.get(alias) === 'on';
                return fallback ?? false;
            }

            function bindAllSwitches() {
                document.querySelectorAll('.ssbbox-switch[data-alias]').forEach(el => {
                    const alias = el.dataset.alias;
                    subscribeStateTopic(alias);

                    // sync ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏à‡∏≤‡∏Å DEVICE_STATE ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ
                    if (typeof DEVICE_STATE?.[alias] !== 'undefined') {
                        el.checked = !!DEVICE_STATE[alias];
                        confirmedModes.set(alias, el.checked ? 'on' : 'off');
                    }

                    // ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏Å‡∏î‡∏™‡∏ß‡∏¥‡∏ï‡∏ä‡πå
                    el.addEventListener('change', () => {
                        const desired = el.checked;

                        if (!(window.publishCmd && window.publishCmd(alias, desired))) {
                            el.checked = getPrevChecked(alias, !desired);
                            return;
                        }

                        el.disabled = true;
                        el.classList.add('is-pending');
                        const wrap = el.closest('.switch-inline');
                        wrap?.classList.add('is-pending');

                        const token = (pendingSeq.get(alias) || 0) + 1;
                        pendingSeq.set(alias, token);
                        desiredMap.set(alias, { val: desired, token });

                        const prevChecked = getPrevChecked(alias, !desired);

                        const timer = setTimeout(() => {
                            if (pendingSeq.get(alias) !== token) return;
                            el.checked = prevChecked;
                            el.classList.remove('is-pending');
                            el.disabled = false;
                            wrap?.classList.remove('is-pending');
                            confirmedModes.set(alias, prevChecked ? 'on' : 'off');
                            desiredMap.delete(alias);
                        }, PENDING_MS);

                        pendingTimers.set(alias, { timer, token, prevChecked });
                    });
                });
            }

            // sync ‡∏à‡∏≤‡∏Å state ‡∏à‡∏£‡∏¥‡∏á ‚Üí ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï UI ‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏™‡∏±‡πà‡∏á
            document.addEventListener('ssbbox:state', e => {
                const { alias, value } = e.detail || {}; if (!alias) return;

                const want = desiredMap.get(alias);
                const hasPending = pendingSeq.has(alias);

                if (hasPending && want && (!!value !== !!want.val)) {
                    DEVICE_STATE[alias] = !!value;
                    return;
                }

                document.querySelectorAll(`.ssbbox-switch[data-alias="${alias}"]`).forEach(el => {
                    el.checked = !!value;
                    el.classList.remove('is-pending');
                    el.disabled = false;
                    const wrap = el.closest('.switch-inline');
                    wrap?.classList.remove('is-pending');
                });

                if (pendingTimers.get(alias)?.timer) clearTimeout(pendingTimers.get(alias).timer);
                pendingTimers.delete(alias);
                pendingSeq.delete(alias);
                desiredMap.delete(alias);

                confirmedModes.set(alias, value ? 'on' : 'off');
                DEVICE_STATE[alias] = !!value;

                log("state ‚Üê", alias, value);
            });

            if (document.readyState === 'loading') document.addEventListener('DOMContentLoaded', bindAllSwitches);
            else bindAllSwitches();
        })();
    </script>

    <!-- ================= onPLCUpdate helper ================= -->
    <script>
        // ‡πÉ‡∏´‡πâ backend ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡πÑ‡∏î‡πâ ‚Üí ‡∏¢‡∏¥‡∏á‡πÄ‡∏Ç‡πâ‡∏≤ event state ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ö WS
        window.onPLCUpdate = ({ alias, power }) => {
            document.dispatchEvent(new CustomEvent('ssbbox:state', {
                detail: { alias, value: !!power, topic: `ssb-box/switch/${alias}/state` }
            }));
        };
    </script>

    <!-- ================= WEBSOCKET (final) ================= -->
    <script>
        const WS_URL = "wss://transition-memo-nails-realm.trycloudflare.com/mqtt";
        let ws, retry;


        /* ---------------- helpers ---------------- */
        const parseMaybe = v => {
            if (typeof v === 'string') { try { return JSON.parse(v); } catch { } }
            return v;
        };

        window.DEVICE_STATE = window.DEVICE_STATE || Object.create(null);
        window.MODE_STATE = window.MODE_STATE || Object.create(null);

        const toB = (typeof window.toBool === 'function')
            ? window.toBool
            : function (v) {
                if (typeof v === 'boolean') return v;
                if (typeof v === 'number') return v !== 0;
                if (typeof v === 'string') {
                    const s = v.trim().toLowerCase();
                    if (['true', 'on', '1'].includes(s)) return true;
                    if (['false', 'off', '0'].includes(s)) return false;
                    const n = Number(s); if (!Number.isNaN(n)) return n !== 0;
                }
                return !!v;
            };

        function safeSubscribe(topics) {
            try { ws?.send(JSON.stringify({ action: "subscribe", topics })); } catch { }
            try { ws?.send(JSON.stringify({ subscribe: topics })); } catch { }
            try { ws?.send(JSON.stringify({ subs: topics })); } catch { }
            try { topics.forEach(t => ws?.send(JSON.stringify({ action: "subscribe", topic: t }))); } catch { }
        }

        function safePublish(topic, payload) {
            try {
                if (!window.ws || ws.readyState !== 1) return false;
                const payloadStr = (typeof payload === 'string') ? payload : JSON.stringify(payload);
                ws.send(JSON.stringify({ topic, payload: payloadStr }));
                return true;
            } catch {
                return false;
            }
        }

        function isSwitchAlias(alias) {
            if (!alias) return false;
            return alias.includes('fan') || alias === 'air' || alias === 'humidifier';
        }

        // üîß Snapshot: ‡πÑ‡∏°‡πà‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏£‡∏π‡∏õ‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡∏à‡∏≤‡∏Å snapshot ‡πÉ‡∏î ‡πÜ (‡πÉ‡∏´‡πâ‡∏£‡∏π‡∏õ‡∏ü‡∏±‡∏á lamp ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô)
        function applySnapshotData(map) {
            if (!map || typeof map !== 'object') return;

            if ('selection' in map) {
                const sel = Array.isArray(map.selection) ? Number(map.selection[0]) : Number(map.selection);
                if (!Number.isNaN(sel)) {
                    handleModeState({ selection: [sel] });
                    window.MODE_STATE = window.MODE_STATE || Object.create(null);
                    MODE_STATE.selection = sel;
                }
            }

            Object.entries(map).forEach(([alias, raw]) => {
                if (alias === 'selection') return;
                const val = isSwitchAlias(alias) ? toB(raw) : raw;
                DEVICE_STATE[alias] = val;

                // ‚ùå ‡πÑ‡∏°‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏Å updateImagesByAlias ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà
                document.dispatchEvent(new CustomEvent('ssbbox:state', {
                    detail: { alias, value: val, topic: '' }
                }));
            });
        }

        // state with topic = ssb-box/(lamp|switch)/<alias>/state, payload = {"<alias>":[true]}
        function applyTopicState(topic, payload) {
            const parts = String(topic || '').split('/');
            if (parts.length < 4 || parts[0] !== 'ssb-box') return false;
            const kind = parts[1]; // 'lamp' | 'switch'
            if (!['lamp', 'switch'].includes(kind) || parts[3] !== 'state') return false;

            const alias = parts[2];
            const p = parseMaybe(payload);

            let raw;
            if (p && typeof p === 'object') {
                if (alias in p) raw = Array.isArray(p[alias]) ? p[alias][0] : p[alias];
                else if ('value' in p) raw = Array.isArray(p.value) ? p.value[0] : p.value;
                else raw = p;
            } else {
                raw = p;
            }

            const val = toB(raw);
            DEVICE_STATE[alias] = val;

            // üîß ‡∏£‡∏π‡∏õ icon: ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏≤‡∏à‡∏≤‡∏Å lamp/*
            if (kind === 'lamp') updateImagesByAlias(alias, val);

            // broadcast state (‡∏û‡∏£‡πâ‡∏≠‡∏° topic) ‚Äî ‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏à‡∏≥‡∏Ñ‡πà‡∏≤/‡∏õ‡∏•‡∏î pending ‡∏Ø‡∏•‡∏Ø
            document.dispatchEvent(new CustomEvent('ssbbox:state', {
                detail: { alias, value: val, topic }
            }));
            return true;
        }

        // ---------- MODE helpers ----------
        function modeAliasFromTopic(topic) {
            const p = String(topic || '').split('/'); // ['ssb-box','mode','<alias>','state']
            return (p.length >= 4 && p[0] === 'ssb-box' && p[1] === 'mode' && p[3] === 'state') ? p[2] : null;
        }

        function parseModePayload(alias, payload) {
            let v = payload;
            if (typeof v === 'string') { try { v = JSON.parse(v); } catch { } }
            if (Array.isArray(v)) return v.length ? v[0] : null;
            if (v && typeof v === 'object') {
                if (alias in v) return Array.isArray(v[alias]) ? v[alias][0] : v[alias];
                if ('selection' in v) return Array.isArray(v.selection) ? v.selection[0] : v.selection;
                if ('value' in v) return Array.isArray(v.value) ? v.value[0] : v.value;
                const ks = Object.keys(v);
                if (ks.length === 1) { let t = v[ks[0]]; return Array.isArray(t) ? t[0] : t; }
                return v;
            }
            if (typeof v === 'string') {
                const s = v.trim().toLowerCase();
                if (['true', 'on', '1'].includes(s)) return true;
                if (['false', 'off', '0'].includes(s)) return false;
                const n = Number(s); if (!Number.isNaN(n)) return n;
            }
            return v;
        }

        function applyModeState(topic, payload) {
            const alias = modeAliasFromTopic(topic);
            if (!alias) return false;

            const val = parseModePayload(alias, payload);
            MODE_STATE[alias] = val;

            if (alias === 'selection') {
                handleModeState(payload);
            }

            document.dispatchEvent(new CustomEvent('ssbbox:mode', {
                detail: { alias, value: val, topic }
            }));
            return true;
        }

        /* ---------------- connect ---------------- */
        function connect() {
            clearTimeout(retry);
            try { ws = new WebSocket(WS_URL); window.ws = ws; } catch { retry = setTimeout(connect, 2000); return; }

            ws.onopen = () => {
                const extra = Array.from(window.SSB_SWITCH_TOPICS || []);
                safeSubscribe([
                    "ssb-box/#",
                    "ssb-box/sensor",
                    "ssb-box/lamp/+/state",
                    "ssb-box/switch/+/state",
                    "ssb-box/mode/+/state",
                    ...extra
                ]);
                console.log("‚úÖ WS connected");
            };

            ws.onclose = () => { window.ws = null; retry = setTimeout(connect, 1500); };

            ws.onmessage = (evt) => {
                let m = evt.data;
                if (typeof m === 'string') { try { m = JSON.parse(m); } catch { } }

                // ===== A) ‡πÑ‡∏°‡πà‡∏°‡∏µ topic (payload-only) =====
                if (m && typeof m === 'object' && !('topic' in m)) {
                    const obj = (m.payload && typeof m.payload === 'object') ? m.payload : m;

                    if (obj && obj.action === 'snapshot' && obj.data && typeof obj.data === 'object') {
                        applySnapshotData(obj.data);
                        return;
                    }

                    if (obj && typeof obj === 'object' && 'selection' in obj) {
                        handleModeState(obj);
                        MODE_STATE.selection = Array.isArray(obj.selection) ? obj.selection[0] : obj.selection;
                        return;
                    }

                    if (obj && typeof obj === 'object') {
                        handleLooseStatePayload(obj);
                        return;
                    }
                }

                // ===== B) ‡∏°‡∏µ topic ‡∏õ‡∏Å‡∏ï‡∏¥ =====
                if (m && typeof m === 'object' && 'topic' in m) {
                    const topic = String(m.topic || '');
                    const p = parseMaybe(m.payload);

                    if (applyModeState(topic, m.payload)) return;
                    if (topic === 'ssb-box/sensor' && p && typeof p === 'object') { handleSensorPayload(p); return; }
                    if (applyTopicState(topic, m.payload)) return;
                }
            };
        }

        /* --------- ‡∏Ñ‡πà‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏ï‡πâ‡∏ô‡∏Å‡πà‡∏≠‡∏ô realtime ‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤ --------- */
        setGauge(document.getElementById('gAir'), 30);
        setGauge(document.getElementById('gRH'), 55);
        setGauge(document.getElementById('gCO2'), 1200);
        setGauge(document.getElementById('gLight'), 1);

        connect();

        /* ---------------- ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á (SEND) ----------------
           topic: ssb-box/switch/<alias>/cmd
           payload: "{\"ductfan\":[true]}"
        --------------------------------------------------- */
        function publishCmd(alias, desired) {
            const topic = `ssb-box/switch/${alias}/cmd`;
            const payloadStr = JSON.stringify({ [alias]: [desired] });
            if (!window.ws || ws.readyState !== 1) { console.warn("[SEND] ws not ready"); return false; }
            const frame = { topic, payload: payloadStr };
            ws.send(JSON.stringify(frame));
            return true;
        }
    </script>

    <!-- üîß NEW: ‡∏à‡∏≥‡∏Ñ‡πà‡∏≤ lamp icon + hydrate ‡∏ï‡∏≠‡∏ô‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤ -->
    <script>
        // 1) ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏û‡∏≤‡∏∞ event ‡∏ó‡∏µ‡πà‡∏°‡∏≤‡∏à‡∏≤‡∏Å topic lamp/*
        document.addEventListener('ssbbox:state', (e) => {
            const { alias, value, topic } = e.detail || {};
            if (!alias) return;
            if (typeof topic === 'string' && topic.startsWith('ssb-box/lamp/')) {
                try { localStorage.setItem(`ssbbox:last:${alias}`, JSON.stringify(!!value)); } catch { }
            }
        });

        // 2) ‡πÇ‡∏´‡∏•‡∏î‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏Ñ‡∏¢‡∏à‡∏≥‡πÑ‡∏ß‡πâ‡∏Ç‡∏∂‡πâ‡∏ô‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡∏ó‡∏∏‡∏Å‡∏ï‡∏±‡∏ß‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡∏ï‡∏≠‡∏ô‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤
        (function hydrateIconsFromLocalStorage() {
            function run() {
                document.querySelectorAll('img.state-img[data-state-alias]').forEach(img => {
                    const alias = img.dataset.stateAlias;
                    try {
                        const raw = localStorage.getItem(`ssbbox:last:${alias}`);
                        if (raw !== null) {
                            const val = JSON.parse(raw);
                            window.DEVICE_STATE = window.DEVICE_STATE || Object.create(null);
                            DEVICE_STATE[alias] = !!val;
                            if (typeof window.updateImagesByAlias === 'function') {
                                updateImagesByAlias(alias, !!val);
                            }
                        }
                    } catch { }
                });
            }
            if (document.readyState === 'loading') document.addEventListener('DOMContentLoaded', run);
            else run();
        })();
    </script>

    <!-- ================= PILL (toggle ‡∏à‡∏≤‡∏Å switch-state + ‡∏à‡∏≥‡∏Ñ‡πà‡∏≤) ================= -->
    <script>
        (function () {
            if (window.__PILL_BINDER__) return; window.__PILL_BINDER__ = true;
            window.SSB_SWITCH_TOPICS = window.SSB_SWITCH_TOPICS || new Set();

            function init() { document.querySelectorAll('.pill[data-alias]').forEach(mount); }

            function mount(el) {
                const label = el.querySelector('[data-label]') || el.querySelector('span');
                const alias = el.dataset.alias.trim();                             // e.g. 'co2'
                const switchKey = (el.dataset.switchKey || (alias + 'of')).trim(); // e.g. 'co2of'
                const cmdTopic = (el.dataset.cmdTopic || `ssb-box/switch/${switchKey}/cmd`).trim();
                const modeTopic = (el.dataset.modeTopic || `ssb-box/mode/${alias}/state`).trim();
                const swStateTopic = (el.dataset.switchStateTopic || `ssb-box/switch/${switchKey}/state`).trim();

                // üîî subscribe ‡∏ó‡∏µ‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô
                try { window.SSB_SWITCH_TOPICS.add(modeTopic); window.SSB_SWITCH_TOPICS.add(swStateTopic); } catch { }
                if (typeof safeSubscribe === 'function') { try { safeSubscribe([modeTopic, swStateTopic]); } catch { } }

                // üß† keys ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏à‡∏≥‡∏Ñ‡πà‡∏≤
                const LS_SW_KEY = `ssbbox:last:${switchKey}`; // ‡∏à‡∏≥‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏™‡∏ß‡∏¥‡∏ï‡∏ä‡πå‡∏à‡∏£‡∏¥‡∏á
                const LS_MODE_KEY = `ssbbox:mode:last:${alias}`; // ‡∏à‡∏≥‡πÇ‡∏´‡∏°‡∏î‡πÑ‡∏ß‡πâ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•

                // üîÅ Hydrate ‡∏™‡∏ß‡∏¥‡∏ï‡∏ä‡πå‡∏à‡∏≤‡∏Å localStorage (‡πÉ‡∏´‡πâ‡∏Å‡∏î‡πÑ‡∏î‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤)
                try {
                    const raw = localStorage.getItem(LS_SW_KEY);
                    if (raw !== null) el.dataset._sw = JSON.parse(raw) ? 'true' : 'false';
                } catch { }

                // üîÅ Hydrate ‡πÇ‡∏´‡∏°‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏™‡∏î‡∏á label (‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÉ‡∏ä‡πâ‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÉ‡∏à‡πÅ‡∏•‡πâ‡∏ß)
                try {
                    const s = localStorage.getItem(LS_MODE_KEY);
                    if (s !== null && s !== '') renderMode(el, label, Number(s));
                } catch { }

                // üõ∞ ‡∏ü‡∏±‡∏á‡∏™‡∏ß‡∏¥‡∏ï‡∏ä‡πå‡∏à‡∏£‡∏¥‡∏á ‚Üí ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ñ‡πà‡∏≤ + ‡∏õ‡∏•‡∏î pending + ‡∏à‡∏≥‡πÑ‡∏ß‡πâ
                document.addEventListener('ssbbox:state', (e) => {
                    const { alias: a, value } = e.detail || {};
                    if (a !== switchKey) return;
                    const v = !!value;
                    el.dataset._sw = String(v);
                    try { localStorage.setItem(LS_SW_KEY, JSON.stringify(v)); } catch { }
                    el.classList.remove('is-pending');
                });

                // üõ∞ ‡∏ü‡∏±‡∏á‡πÇ‡∏´‡∏°‡∏î‡∏à‡∏£‡∏¥‡∏á ‚Üí ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏ö‡∏ô pill (‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÉ‡∏à)
                document.addEventListener('ssbbox:mode', (e) => {
                    const { alias: a, value } = e.detail || {};
                    if (a !== alias) return;
                    const code = Array.isArray(value) ? Number(value[0]) : Number(value);
                    if (!Number.isNaN(code)) {
                        renderMode(el, label, code);
                        try { localStorage.setItem(LS_MODE_KEY, String(code)); } catch { }
                    }
                });

                // üëÜ ‡∏Ñ‡∏•‡∏¥‡∏Å = toggle ‡∏à‡∏≤‡∏Å switch-state ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î (‡πÑ‡∏°‡πà‡∏î‡∏π data-off-code ‡πÅ‡∏•‡πâ‡∏ß)
                let pendingTimer = null;
                el.style.cursor = 'pointer';
                el.addEventListener('click', () => {
                    if (el.classList.contains('is-pending')) return;

                    const cur = (el.dataset._sw === 'true');
                    const desired = !cur;

                    const ok = (typeof safePublish === 'function')
                        && safePublish(cmdTopic, JSON.stringify({ [switchKey]: [Boolean(desired)] }));

                    if (!ok) { console.warn('[pill] publish failed'); return; }

                    el.classList.add('is-pending');
                    clearTimeout(pendingTimer);
                    pendingTimer = setTimeout(() => el.classList.remove('is-pending'), 3000);
                });
            }

            function renderMode(el, label, code) {
                el.classList.remove('auto', 'manual', 'task', 'off', 'unknown');
                switch (Number(code)) {
                    case 0: el.classList.add('manual'); label.textContent = 'Manual'; break;
                    case 1: el.classList.add('auto'); label.textContent = 'Auto'; break;
                    case 2: el.classList.add('task'); label.textContent = 'Task'; break;
                    case 3: el.classList.add('off'); label.textContent = 'Off'; break;
                    default: el.classList.add('unknown'); label.textContent = 'Unknown';
                }
            }

            if (document.readyState === 'loading') document.addEventListener('DOMContentLoaded', init);
            else init();
        })();
    </script>

    </script>

    <!-- ================= THEME & TABS ================= -->
    <script>
        (function () {
            const BTN = document.querySelector('.darklight');
            function setBtnLabel() {
                const s = localStorage.getItem('themeIcon') || 'dark';
                if (BTN) BTN.textContent = (s === 'dark') ? 'üåô Dark' : '‚òÄÔ∏è Light';
            }
            if (BTN) {
                BTN.addEventListener('click', () => {
                    const cur = localStorage.getItem('themeIcon') || 'dark';
                    const next = (cur === 'dark') ? 'light' : 'dark';
                    localStorage.setItem('themeIcon', next);
                    setBtnLabel();
                });
            }
            setBtnLabel();

            document.querySelectorAll('.tabs .tab').forEach(tab => {
                tab.style.cursor = 'pointer';
                tab.addEventListener('click', () => {
                    document.querySelectorAll('.tabs .tab').forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    if (tab.dataset.href) window.location.href = tab.dataset.href;
                });
            });
        })();
    </script>

    <!-- ================= SNAPSHOT (sensor) ================= -->
    <script>
        const SNAP_KEY = 'ssbbox:last-sensor', SNAP_MAX_AGE_MS = 0;
        function saveSnapshot(payload) {
            try { localStorage.setItem(SNAP_KEY, JSON.stringify({ ts: Date.now(), data: payload })); } catch { }
        }
        function loadSnapshot() {
            try {
                const raw = localStorage.getItem(SNAP_KEY); if (!raw) return null;
                const snap = JSON.parse(raw); if (!snap || !snap.data) return null;
                if (SNAP_MAX_AGE_MS > 0 && Date.now() - (snap.ts || 0) > SNAP_MAX_AGE_MS) return null;
                return snap.data;
            } catch { return null; }
        }
        (function () { const snap = loadSnapshot(); if (snap) handleSensorPayload(snap); })();
    </script>

    <!-- ================= Mode ================= -->
    <script>
        const MODE_LABEL = { 0: 'MANUAL', 1: 'AUTO', 2: 'TASK' };

        let MODE_PENDING = null, MODE_TOKEN = 0, MODE_TIMER = null;
        const MODE_PENDING_MS = 5000;

        function setModePending(flag) {
            const btn = document.querySelector('#modeDropdown > button');
            if (!btn) return;
            if (flag) {
                btn.classList.add('is-pending');
                btn.setAttribute('disabled', 'disabled');
            } else {
                btn.classList.remove('is-pending');
                btn.removeAttribute('disabled');
            }
        }

        function updateModeUI(sel) {
            const btn = document.querySelector('#modeDropdown > button');
            const pill = document.getElementById('statusPill');
            const pillLabel = document.getElementById('statusLabel');

            if (btn && sel !== undefined) {
                btn.textContent = "MODE: " + ({ 0: 'MANUAL', 1: 'AUTO', 2: 'TASK' }[sel] ?? sel);
                btn.classList.remove('mode-auto', 'mode-manual', 'mode-task', 'mode-off');
                if (sel === 1) btn.classList.add('mode-auto');
                else if (sel === 0) btn.classList.add('mode-manual');
                else if (sel === 2) btn.classList.add('mode-task');
                else btn.classList.add('mode-off');
            }
        }

        function handleModeState(payload) {
            let rawMinified = payload;
            let sel;
            try {
                const obj = (typeof payload === 'string') ? JSON.parse(payload) : payload;
                sel = Array.isArray(obj?.selection) ? obj.selection[0] : undefined;
                rawMinified = JSON.stringify({ selection: [sel] });
            } catch {
                const m = String(payload || '').match(/"selection"\s*:\s*\[\s*(\d+)\s*\]/);
                if (m) {
                    sel = parseInt(m[1], 10);
                    rawMinified = `{"selection":[${sel}]}`;
                }
            }

            document.getElementById('modeRaw')?.replaceChildren(rawMinified);
            document.getElementById('modeLabel')?.replaceChildren(
                (sel in MODE_LABEL) ? MODE_LABEL[sel] : (sel !== undefined ? `UNKNOWN(${sel})` : '-')
            );

            if (sel !== undefined) updateModeUI(sel);

            if (MODE_PENDING && sel !== undefined) {
                if (sel === MODE_PENDING.val) {
                    setModePending(false);
                    MODE_PENDING = null;
                    if (MODE_TIMER) { clearTimeout(MODE_TIMER); MODE_TIMER = null; }
                }
            }
        }

        (function bindModeDropdown() {
            const root = document.getElementById('modeDropdown');
            if (!root) return;

            const btn = root.querySelector('button');
            let dd = null;
            try { dd = bootstrap.Dropdown.getOrCreateInstance(btn); } catch { }

            root.querySelectorAll('.dropdown-item').forEach(a => {
                a.addEventListener('click', (e) => {
                    e.preventDefault();
                    const val = parseInt(a.dataset.val, 10);
                    const payload = `{"selection":[${val}]}`;

                    const ok = (typeof safePublish === 'function')
                        ? safePublish("ssb-box/mode/selection/cmd", payload)
                        : false;

                    if (!ok) { console.warn("[MODE] ws not ready, cannot publish"); return; }

                    MODE_TOKEN += 1;
                    MODE_PENDING = { val, token: MODE_TOKEN };
                    setModePending(true);
                    if (dd) dd.hide();

                    if (MODE_TIMER) clearTimeout(MODE_TIMER);
                    MODE_TIMER = setTimeout(() => {
                        if (MODE_PENDING && MODE_PENDING.token === MODE_TOKEN) {
                            setModePending(false);
                            MODE_PENDING = null;
                            MODE_TIMER = null;
                        }
                    }, MODE_PENDING_MS);
                });
            });
        })();
    </script>

    <script>
        // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏â‡∏û‡∏≤‡∏∞ alias ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏™‡∏ß‡∏¥‡∏ï‡∏ä‡πå‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤ (‡∏Å‡∏±‡∏ô‡πÑ‡∏õ‡∏ä‡∏ô‡∏û‡∏ß‡∏Å lamp)
        document.addEventListener('ssbbox:state', (e) => {
            const { alias } = e.detail || {};
            if (!alias) return;
            // ‡∏°‡∏µ‡∏™‡∏ß‡∏¥‡∏ï‡∏ä‡πå‡∏ï‡∏±‡∏ß‡∏ô‡∏µ‡πâ‡∏≠‡∏¢‡∏π‡πà‡∏à‡∏£‡∏¥‡∏á‡πÉ‡∏ô DOM ‡πÑ‡∏´‡∏°?
            const hasSwitch = !!document.querySelector(`.ssbbox-switch[data-alias="${alias}"]`);
            if (!hasSwitch) return;
            try { localStorage.setItem(`ssbbox:last:${alias}`, JSON.stringify(!!e.detail.value)); } catch { }
        });
    </script>


    <script>
        (function hydrateSwitchesFromLocalStorage() {
            function run() {
                window.DEVICE_STATE = window.DEVICE_STATE || Object.create(null);
                document.querySelectorAll('.ssbbox-switch[data-alias]').forEach(el => {
                    const a = el.dataset.alias;
                    try {
                        const raw = localStorage.getItem(`ssbbox:last:${a}`);
                        if (raw !== null) {
                            const v = !!JSON.parse(raw);
                            DEVICE_STATE[a] = v;  // ‡πÉ‡∏´‡πâ bindAllSwitches ‡πÄ‡∏´‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
                            el.checked = v;       // ‡πÉ‡∏´‡πâ UI ‡∏ï‡∏£‡∏á‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
                        }
                    } catch { }
                });
            }
            if (document.readyState === 'loading') document.addEventListener('DOMContentLoaded', run);
            else run();
        })();
    </script>









</body>

</html>